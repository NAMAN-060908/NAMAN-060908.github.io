<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Learn Ease - Advanced Features</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        /* General Body and Font Styles */
        body {
            font-family: 'Poppins', sans-serif; /* Apply Poppins font globally for a modern look */
            background-color: #f0f2f5; /* Light gray background for a clean feel */
            color: #333; /* Dark gray text color for readability */
            line-height: 1.6; /* Improved line spacing for better text flow */
            -webkit-font-smoothing: antialiased; /* Smoother font rendering for webkit browsers */
            -moz-osx-font-smoothing: grayscale; /* Smoother font rendering for macOS Firefox */
        }

        /* Fixed Navbar Offset for smooth scrolling */
        html {
            scroll-padding-top: 96px; /* Adjusts scroll position to account for fixed navbar height, preventing content from being hidden behind it */
        }

        /* Hero Section Styling */
        .hero-section {
            /* Luxurious Gradient Background: Deep blue to deep purple, creating a rich visual appeal */
            background: linear-gradient(to right, #0a1f44, #2a0a44);
            color: white; /* White text for strong contrast against the dark background */
            text-shadow: 2px 2px 8px rgba(0,0,0,0.6); /* Stronger shadow for text readability, making it pop */
            min-height: 70vh; /* Minimum height of 70% of viewport height, ensuring it fills a significant portion of the screen */
            display: flex;
            align-items: center; /* Vertically center content within the hero section */
            justify-content: flex-start; /* Align content to the left for a structured layout */
            text-align: left; /* Text alignment within the hero content */
            padding-top: 96px; /* Adjust for fixed navbar to prevent content overlap */
            position: relative; /* Needed for positioning child elements like blob animations */
            overflow: hidden; /* Hides overflowing blob animations, keeping the design clean */
        }

        .hero-content {
            max-width: 800px; /* Limits content width for better readability and visual balance */
            padding-left: 4rem; /* More padding on the left side, pushing content away from the edge */
            padding-right: 2rem;
            z-index: 10; /* Ensures content is above background animations, making it interactive */
        }

        /* Section Header Styles: Applied to main headings of content sections */
        .section-header {
            font-size: 3.5rem; /* Approximately 56px, large and impactful */
            font-weight: 800; /* Extra bold font weight for strong emphasis */
            color: #1a202c; /* Equivalent to Tailwind's text-gray-900, a deep, rich dark color */
            line-height: 1.2; /* Tighter line height for headings, making them compact and powerful */
            margin-bottom: 1.5rem; /* Space below the header */
        }

        /* Section Subheader Styles: Applied to secondary headings or descriptive text below main headers */
        .section-subheader {
            font-size: 1.5rem; /* Approximately 24px, clear and readable */
            font-weight: 600; /* Semi-bold font weight for good hierarchy */
            color: #4a5568; /* Equivalent to Tailwind's text-gray-700, a softer dark color */
            margin-bottom: 2.5rem; /* More space below the subheader */
        }

        /* Course Card Styles: Defines the look and feel of individual course display cards */
        .course-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease; /* Smooth transition for hover effects, enhancing user experience */
            cursor: pointer; /* Indicates interactivity, inviting clicks */
            border-radius: 1.5rem; /* More rounded corners for a modern, friendly aesthetic */
            overflow: hidden; /* Ensures content stays within rounded borders, preventing bleed */
            box-shadow: 0 10px 20px rgba(0,0,0,0.08); /* Softer initial shadow, giving a subtle lift */
            display: flex; /* Use flexbox for internal layout */
            flex-direction: column; /* Stack content vertically */
            align-items: center; /* Center items horizontally */
            text-align: center; /* Center text within the card */
            padding: 2rem; /* Internal padding */
            background-color: #ffffff; /* White background */
            border: 1px solid #e2e8f0; /* Subtle border */
        }

        .course-card:hover {
            transform: translateY(-10px); /* Lifts the card up by 10px on hover, creating a floating effect */
            box-shadow: 0 20px 40px rgba(0,0,0,0.2); /* Deeper shadow on hover, emphasizing the lift */
            border-color: #3b82f6; /* Highlight border on hover */
        }

        /* Unified Modal Styling: Defines the overarching style for all modal pop-ups */
        .modal {
            display: none; /* Hidden by default, only shown via JavaScript */
            position: fixed; /* Stays in place relative to the viewport, covering the entire screen */
            z-index: 1000; /* Sits on top of all other content, ensuring visibility */
            left: 0;
            top: 0;
            width: 100%; /* Full width of the viewport */
            height: 100%; /* Full height of the viewport */
            overflow: auto; /* Enables scrolling if modal content exceeds viewport height */
            background-color: rgba(0,0,0,0.7); /* Darker semi-transparent overlay, dimming the background */
            backdrop-filter: blur(12px); /* Stronger blur effect for background, creating a frosted glass effect */
            -webkit-backdrop-filter: blur(12px); /* Safari support for backdrop-filter */
            display: flex; /* Uses flexbox for centering content within the modal */
            align-items: center; /* Vertically centers modal content */
            justify-content: center; /* Horizontally centers modal content */
            opacity: 0; /* Starts fully transparent for a smooth fade-in effect */
            transition: opacity 0.5s ease-in-out; /* Slower, smoother fade-in transition */
            pointer-events: none; /* Allows clicks to pass through when hidden (opacity 0), preventing accidental interaction */
        }

        .modal.show {
            opacity: 1; /* Fully opaque when shown, completing the fade-in */
            pointer-events: auto; /* Disables clicks through when shown, making the modal interactive */
        }

        .modal-content {
            background-color: #ffffff; /* Pure white content background for a crisp look */
            margin: auto; /* Centers the content within the flex container */
            padding: 3.5rem; /* Increased padding inside the modal for more breathing room */
            border-radius: 2.5rem; /* Even more rounded corners for a soft, modern feel */
            width: 90%; /* Occupies 90% of modal width on larger screens */
            max-width: 1000px; /* Maximum width for the modal, preventing it from becoming too wide */
            position: relative; /* Needed for positioning the close button */
            box-shadow: 0 25px 50px rgba(0,0,0,0.4); /* Much stronger, diffused shadow, giving a sense of depth */
            transform: translateY(50px); /* Starts 50px lower for an elegant slide-in effect */
            transition: transform 0.5s ease-in-out; /* Slower, smoother slide-in transition */
            max-height: 90vh; /* Limits content height to 90% of viewport height */
            overflow-y: auto; /* Enables vertical scrolling for content if it overflows */
        }

        .modal.show .modal-content {
            transform: translateY(0); /* Slides content to its final, visible position */
        }

        .close-button {
            color: #666; /* Softer close button color, less intrusive */
            position: absolute;
            top: 1.8rem; /* Adjusted position from top for better visual balance */
            right: 2.2rem; /* Adjusted position from right */
            font-size: 3.2rem; /* Larger close button icon, easy to click */
            font-weight: bold;
            cursor: pointer; /* Indicates interactivity */
            transition: color 0.3s; /* Smooth color transition on hover */
        }

        .close-button:hover,
        .close-button:focus {
            color: #000; /* Darker on hover for clear feedback */
            text-decoration: none; /* Removes underline on focus/hover */
        }

        /* Keyframe Animations: Define reusable animation sequences */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fade-in-down {
            from { opacity: 0; transform: translateY(-30px); } /* Starts further up for a more pronounced drop-in effect */
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fade-in-up {
            from { opacity: 0; transform: translateY(30px); } /* Starts further down for a more pronounced slide-up effect */
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes zoom-in {
            from { opacity: 0; transform: scale(0.8); } /* Starts smaller for a subtle zoom effect */
            to { opacity: 1; transform: scale(1); }
        }

        /* Apply Animations with specific durations and easing */
        .animate-fade-in-down { animation: fade-in-down 0.9s ease-out forwards; }
        .animate-fade-in-up { animation: fade-in-up 0.9s ease-out forwards; }
        .animate-zoom-in { animation: zoom-in 0.9s ease-out forwards; }

        /* Blob Background Animation for Hero and Courses sections: Creates organic, floating shapes */
        @keyframes blob {
            0% { transform: translate(0px, 0px) scale(1); }
            33% { transform: translate(30px, -50px) scale(1.1); }
            66% { transform: translate(-20px, 20px) scale(0.9); }
            100% { transform: translate(0px, 0px) scale(1); }
        }
        .animate-blob { animation: blob 7s infinite cubic-bezier(0.6, 0.01, 0.3, 0.9); } /* Smooth, continuous animation */
        .animation-delay-2000 { animation-delay: 2s; } /* Delays start of animation for staggered effect */
        .animation-delay-4000 { animation-delay: 4s; }
        .animation-delay-6000 { animation-delay: 6s; }

        /* Chatbot Specific Styles */
        #chatbot-container {
            display: flex;
            flex-direction: column; /* Stacks children vertically */
            height: 500px; /* Fixed height for the chat window, providing a consistent UI */
            border: 1px solid #e2e8f0; /* Light gray border for a subtle definition */
            border-radius: 0.75rem; /* Rounded corners for a softer look */
            overflow: hidden; /* Hides content that overflows, ensuring clean edges */
            background-color: #f8fafc; /* Very light blue-gray background for the chat area */
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.05); /* Inner shadow for depth, giving a slightly sunken effect */
        }

        #chat-messages {
            flex-grow: 1; /* Allows message area to take up available space, pushing input to bottom */
            padding: 1rem;
            overflow-y: auto; /* Enables vertical scrolling for messages, handling long conversations */
            background-color: #ffffff; /* White background for messages */
            border-bottom: 1px solid #e2e8f0; /* Separator from input area */
        }

        .chat-message {
            margin-bottom: 0.75rem;
            padding: 0.5rem 0.75rem;
            border-radius: 0.5rem;
            max-width: 80%; /* Limits message bubble width for better readability */
            line-height: 1.5;
            word-wrap: break-word; /* Ensures long words break to fit within the bubble */
        }

        .chat-message.user {
            background-color: #e0f2fe; /* Light blue for user messages, distinguishing them */
            align-self: flex-end; /* Aligns user messages to the right */
            margin-left: auto; /* Pushes user messages to the right */
        }

        .chat-message.ai {
            background-color: #f0f4f8; /* Light gray for AI messages, distinguishing them */
            align-self: flex-start; /* Aligns AI messages to the left */
            margin-right: auto; /* Pushes AI messages to the left */
        }

        #chat-input-container {
            display: flex;
            padding: 1rem;
            gap: 0.5rem; /* Space between input and button */
            background-color: #f0f2f5; /* Slightly different background for input area */
            border-top: 1px solid #e2e8f0; /* Separator from message area */
        }

        #chat-input {
            flex-grow: 1; /* Allows input to take up available space */
            border-radius: 0.5rem;
            border: 1px solid #cbd5e0; /* Light gray border */
            padding: 0.75rem 1rem;
            background-color: #ffffff;
            transition: border-color 0.2s, box-shadow 0.2s; /* Smooth transitions for focus effects */
        }

        #chat-input:focus {
            outline: none; /* Removes default outline */
            border-color: #3b82f6; /* Blue border on focus */
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2); /* Blue glow on focus */
        }

        #chat-send-button {
            padding: 0.75rem 1.25rem;
            background-color: #3b82f6; /* Blue background */
            color: white; /* White text */
            border-radius: 0.5rem;
            font-weight: 600;
            transition: background-color 0.2s, transform 0.2s; /* Smooth transitions for hover effects */
            box-shadow: 0 4px 8px rgba(0,0,0,0.1); /* Subtle shadow */
        }

        #chat-send-button:hover {
            background-color: #2563eb; /* Darker blue on hover */
            transform: translateY(-2px); /* Lifts button slightly on hover */
            box-shadow: 0 6px 12px rgba(0,0,0,0.15); /* Deeper shadow on hover */
        }

        #chat-send-button:disabled {
            background-color: #9ca3af; /* Gray background when disabled */
            cursor: not-allowed; /* Not-allowed cursor */
            transform: none; /* No transform when disabled */
            box-shadow: none; /* No shadow when disabled */
        }

        #chat-loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            color: #3b82f6; /* Blue loading text */
            font-weight: 500;
        }

        /* Responsive Adjustments for smaller screens */
        @media (max-width: 768px) {
            .hero-section {
                text-align: center; /* Center content on smaller screens */
                justify-content: center; /* Center content horizontally */
                padding-left: 1rem; /* Adjust padding */
                padding-right: 1rem;
            }

            .hero-content {
                padding-left: 1rem; /* Adjust padding */
                padding-right: 1rem;
            }

            .section-header {
                font-size: 2.5rem; /* Smaller font size for headers on mobile */
            }

            .section-subheader {
                font-size: 1.2rem; /* Smaller font size for subheaders on mobile */
            }

            .course-card {
                padding: 1.5rem; /* Reduce padding on course cards */
            }

            .modal-content {
                padding: 2rem; /* Reduce modal padding on smaller screens */
                border-radius: 1.5rem; /* Slightly less rounded */
            }

            .close-button {
                font-size: 2.5rem; /* Smaller close button */
                top: 1rem;
                right: 1.5rem;
            }

            #navbar-links {
                transition: max-height 0.3s ease-out; /* Smooth transition for mobile menu toggle */
                overflow: hidden; /* Hide overflowing content during transition */
                max-height: 0; /* Initially hidden */
            }

            #navbar-links.open {
                max-height: 500px; /* Max height when open (adjust as needed) */
            }
        }

        /* Even smaller screens (e.g., mobile landscape) */
        @media (max-width: 480px) {
            .hero-section h1 {
                font-size: 3rem; /* Further reduce hero title size */
            }

            .hero-section p {
                font-size: 1.1rem; /* Further reduce hero paragraph size */
            }

            .course-card img {
                width: 100px; /* Smaller images on course cards */
                height: 100px;
            }

            .course-card h3 {
                font-size: 1.5rem; /* Smaller course titles */
            }

            .modal-content {
                width: 95%; /* Wider modal on very small screens */
                padding: 1.5rem;
            }
        }

        /* Additional styling for interactive elements to ensure visual feedback */
        button {
            cursor: pointer;
            outline: none; /* Remove default outline */
            border: none; /* Remove default border */
        }

        a {
            text-decoration: none; /* Remove default underline */
        }

        input[type="text"],
        input[type="email"],
        input[type="password"],
        textarea {
            appearance: none; /* Remove default browser styling */
            -webkit-appearance: none;
            -moz-appearance: none;
            background-color: #f8fafc; /* Light background for inputs */
            border: 1px solid #cbd5e0; /* Subtle border */
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        input[type="text"]:focus,
        input[type="email"]:focus,
        input[type="password"]:focus,
        textarea:focus {
            border-color: #3b82f6; /* Blue border on focus */
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2); /* Blue glow on focus */
            outline: none;
        }

        /* Specific styles for the payment form inputs */
        #payment-view input {
            letter-spacing: 1px; /* Slightly spaced letters for card numbers */
        }

        #payment-view #card-number {
            font-family: 'monospace'; /* Monospace font for card number */
        }

        /* Styling for loading spinners */
        .animate-spin {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Utility classes for hiding/showing elements smoothly */
        .fade-in {
            opacity: 0;
            animation: fadeIn 0.5s forwards;
        }
        .fade-out {
            opacity: 1;
            animation: fadeOut 0.5s forwards;
        }
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
    </style>
</head>
<body>
    <nav class="bg-white shadow-lg fixed w-full z-50 py-4 border-b border-gray-200">
        <div class="container mx-auto px-8 md:flex md:justify-between md:items-center">
            <div class="flex justify-between items-center">
                <a href="#" class="text-3xl font-extrabold text-blue-800 hover:text-blue-900 transition duration-300">Learn Ease</a>
                <button id="mobile-menu-button" class="md:hidden text-gray-600 hover:text-gray-900 focus:outline-none focus:text-gray-900">
                    <svg class="h-8 w-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path>
                    </svg>
                </button>
            </div>
            <div id="navbar-links" class="md:flex flex-col md:flex-row md:items-center md:space-x-8 mt-4 md:mt-0 hidden">
                <a href="#home" class="block text-lg font-medium text-gray-700 hover:text-blue-700 transition duration-300 py-2 md:py-0">Home</a>
                <a href="#courses" class="block text-lg font-medium text-gray-700 hover:text-blue-700 transition duration-300 py-2 md:py-0">Courses</a>
                <a href="#about" class="block text-lg font-medium text-gray-700 hover:text-blue-700 transition duration-300 py-2 md:py-0">About Us</a>
                <a href="#why-us" class="block text-lg font-medium text-gray-700 hover:text-blue-700 transition duration-300 py-2 md:py-0">Why Us</a>
                <a href="#uniqueness" class="block text-lg font-medium text-gray-700 hover:text-blue-700 transition duration-300 py-2 md:py-0">Our Uniqueness</a>
                <a href="#contact" class="block text-lg font-medium text-gray-700 hover:text-blue-700 transition duration-300 py-2 md:py-0">Contact Us</a>
                <div class="flex flex-col md:flex-row space-y-2 md:space-y-0 md:space-x-4 mt-4 md:mt-0">
                    <button type="button" id="login-button" class="px-8 py-3 bg-blue-700 text-white font-semibold rounded-full shadow-lg hover:bg-blue-800 transition duration-300 text-lg">Login</button>
                    <button type="button" id="signup-button" class="px-8 py-3 border border-blue-700 text-blue-800 font-semibold rounded-full hover:bg-blue-50 transition duration-300 text-lg">Sign Up</button>
                    <button type="button" id="my-courses-button" class="px-8 py-3 bg-indigo-600 text-white font-semibold rounded-full shadow-lg hover:bg-indigo-700 transition duration-300 text-lg hidden">My Courses</button>
                    <button type="button" id="upload-image-button" class="px-8 py-3 bg-green-600 text-white font-semibold rounded-full shadow-lg hover:bg-green-700 transition duration-300 text-lg hidden">Upload Image</button>
                    <button type="button" id="chat-ai-button" class="px-8 py-3 bg-purple-600 text-white font-semibold rounded-full shadow-lg hover:bg-purple-700 transition duration-300 text-lg hidden">Chat with AI</button>
                    <button type="button" id="payment-button" class="px-8 py-3 bg-yellow-500 text-gray-900 font-semibold rounded-full shadow-lg hover:bg-yellow-600 transition duration-330 text-lg hidden">Payment</button>
                    <button type="button" id="logout-button" class="px-8 py-3 bg-red-600 text-white font-semibold rounded-full shadow-lg hover:bg-red-700 transition duration-300 text-lg hidden">Logout</button>
                </div>
            </div>
        </div>
    </nav>

    <section id="home" class="hero-section relative">
        <div class="container mx-auto px-8 py-20 hero-content">
            <h1 class="text-5xl md:text-6xl font-extrabold leading-tight mb-6 animate-fade-in-down">
                Unlock Your <span class="text-amber-300">Potential</span> with <br>Learn Ease
            </h1>
            <p class="text-xl md:text-2xl mb-10 leading-relaxed opacity-90 animate-fade-in-up">
                Master trending skills like Data Science, AI, and Web Development with expert-led courses and personalized learning paths.
            </p>
            <button class="px-10 py-5 bg-amber-400 text-blue-900 font-bold text-xl rounded-full shadow-2xl hover:bg-amber-500 transition duration-300 transform hover:scale-105 animate-zoom-in" onclick="document.getElementById('courses').scrollIntoView({ behavior: 'smooth' });">
                Explore Courses
            </button>
        </div>
        <div class="absolute top-0 left-0 w-full h-full">
            <div class="absolute -top-1/4 -left-1/4 w-96 h-96 bg-blue-300 rounded-full mix-blend-multiply filter blur-xl opacity-20 animate-blob"></div>
            <div class="absolute -bottom-1/4 -right-1/4 w-80 h-80 bg-purple-300 rounded-full mix-blend-multiply filter blur-xl opacity-20 animate-blob animation-delay-2000"></div>
        </div>
    </section>

    <section id="courses" class="py-20 bg-gray-100 relative overflow-hidden">
        <div class="container mx-auto px-8">
            <h2 class="text-5xl font-extrabold text-center text-gray-900 mb-6 section-header">Our Popular Courses</h2>
            <p class="text-xl text-center text-gray-700 mb-16 section-subheader">Discover a wide range of in-demand courses taught by industry experts.</p>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-12">
                <div class="course-card bg-white rounded-2xl shadow-xl p-8 flex flex-col items-center text-center border-b-4 border-blue-600" data-course-id="data-science">
                    <img src="https://placehold.co/150x150/4a90e2/ffffff/webp?text=Data+Science" alt="Data Science Icon" class="w-36 h-36 mb-6 rounded-full border-4 border-blue-100 p-2 object-cover">
                    <h3 class="text-2xl font-bold text-gray-900 mb-3">Data Science Masterclass</h3>
                    <p class="text-gray-700 mb-4">Unleash the power of data with Python, R, Machine Learning, and AI.</p>
                    <div class="flex items-center text-gray-600 text-lg">
                        <svg class="w-6 h-6 mr-2 text-blue-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l3 3a1 1 0 001.414-1.414L11 9.586V6z" clip-rule="evenodd"></path></svg>
                        <span>6 Months</span>
                    </div>
                </div>
                <div class="course-card bg-white rounded-2xl shadow-xl p-8 flex flex-col items-center text-center border-b-4 border-green-600" data-course-id="web-development">
                    <img src="https://placehold.co/150x150/2ecc71/ffffff/webp?text=Web+Dev" alt="Web Development Icon" class="w-36 h-36 mb-6 rounded-full border-4 border-green-100 p-2 object-cover">
                    <h3 class="text-2xl font-bold text-gray-900 mb-3">Full Stack Web Development</h3>
                    <p class="text-gray-700 mb-4">Build powerful web applications from front-end to back-end.</p>
                    <div class="flex items-center text-gray-600 text-lg">
                        <svg class="w-6 h-6 mr-2 text-green-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l3 3a1 1 0 001.414-1.414L11 9.586V6z" clip-rule="evenodd"></path></svg>
                        <span>5 Months</span>
                    </div>
                </div>
                <div class="course-card bg-white rounded-2xl shadow-xl p-8 flex flex-col items-center text-center border-b-4 border-purple-600" data-course-id="ai-ml">
                    <img src="https://placehold.co/150x150/9b59b6/ffffff/webp?text=AI+%26+ML" alt="AI & ML Icon" class="w-36 h-36 mb-6 rounded-full border-4 border-purple-100 p-2 object-cover">
                    <h3 class="text-2xl font-bold text-gray-900 mb-3">Artificial Intelligence & ML</h3>
                    <p class="text-gray-700 mb-4">Dive deep into algorithms, neural networks, and intelligent systems.</p>
                    <div class="flex items-center text-gray-600 text-lg">
                        <svg class="w-6 h-6 mr-2 text-purple-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l3 3a1 1 0 001.414-1.414L11 9.586V6z" clip-rule="evenodd"></path></svg>
                        <span>7 Months</span>
                    </div>
                </div>
                <div class="course-card bg-white rounded-2xl shadow-xl p-8 flex flex-col items-center text-center border-b-4 border-orange-600" data-course-id="digital-marketing">
                    <img src="https://placehold.co/150x150/e67e22/ffffff/webp?text=Digital+Mkt" alt="Digital Marketing Icon" class="w-36 h-36 mb-6 rounded-full border-4 border-orange-100 p-2 object-cover">
                    <h3 class="text-2xl font-bold text-gray-900 mb-3">Certified Digital Marketing</h3>
                    <p class="text-gray-700 mb-4">Master SEO, SEM, Social Media, and Content Marketing strategies.</p>
                    <div class="flex items-center text-gray-600 text-lg">
                        <svg class="w-6 h-6 mr-2 text-orange-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l3 3a1 1 0 001.414-1.414L11 9.586V6z" clip-rule="evenodd"></path></svg>
                        <span>4 Months</span>
                    </div>
                </div>
                <div class="course-card bg-white rounded-2xl shadow-xl p-8 flex flex-col items-center text-center border-b-4 border-red-600" data-course-id="cloud-computing">
                    <img src="https://placehold.co/150x150/e74c3c/ffffff/webp?text=Cloud+Comp" alt="Cloud Computing Icon" class="w-36 h-36 mb-6 rounded-full border-4 border-red-100 p-2 object-cover">
                    <h3 class="text-2xl font-bold text-gray-900 mb-3">Cloud Computing Fundamentals</h3>
                    <p class="text-gray-700 mb-4">Learn AWS, Azure, and GCP essentials for modern IT infrastructure.</p>
                    <div class="flex items-center text-gray-600 text-lg">
                        <svg class="w-6 h-6 mr-2 text-red-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l3 3a1 1 0 001.414-1.414L11 9.586V6z" clip-rule="evenodd"></path></svg>
                        <span>5 Months</span>
                    </div>
                </div>
                <div class="course-card bg-white rounded-2xl shadow-xl p-8 flex flex-col items-center text-center border-b-4 border-teal-600" data-course-id="ui-ux-design">
                    <img src="https://placehold.co/150x150/1abc9c/ffffff/webp?text=UI%2FUX" alt="UI/UX Design Icon" class="w-36 h-36 mb-6 rounded-full border-4 border-teal-100 p-2 object-cover">
                    <h3 class="text-2xl font-bold text-gray-900 mb-3">Professional UI/UX Design</h3>
                    <p class="text-gray-700 mb-4">Create intuitive and beautiful user experiences for web and mobile.</p>
                    <div class="flex items-center text-gray-600 text-lg">
                        <svg class="w-6 h-6 mr-2 text-teal-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l3 3a1 1 0 001.414-1.414L11 9.586V6z" clip-rule="evenodd"></path></svg>
                        <span>4 Months</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="absolute top-1/4 left-0 w-64 h-64 bg-blue-200 rounded-full mix-blend-multiply filter blur-xl opacity-30 animate-blob"></div>
        <div class="absolute bottom-1/4 right-0 w-80 h-80 bg-green-200 rounded-full mix-blend-multiply filter blur-xl opacity-30 animate-blob animation-delay-2000"></div>
    </section>

    <section id="about" class="py-20 bg-white">
        <div class="container mx-auto px-8 grid grid-cols-1 md:grid-cols-2 gap-16 items-center">
            <div class="order-2 md:order-1">
                <h2 class="text-5xl font-extrabold text-gray-900 mb-6 section-header text-center md:text-left">About Learn Ease</h2>
                <p class="text-xl text-gray-700 mb-6 leading-relaxed section-subheader text-center md:text-left">
                    At Learn Ease, we believe that education should be accessible, effective, and empowering. We are dedicated to providing high-quality, industry-relevant online courses taught by leading experts.
                </p>
                <p class="text-lg text-gray-600 leading-relaxed text-center md:text-left">
                    Our mission is to bridge the gap between traditional education and industry demands, ensuring our students are well-equipped with the skills needed to thrive in the modern workforce. We focus on hands-on learning, practical projects, and a supportive community to foster true mastery.
                </p>
            </div>
            <div class="order-1 md:order-2">
                <img src="https://placehold.co/700x500/a7d9f7/ffffff/webp?text=Learning+Journey" alt="Learning Journey" class="rounded-2xl shadow-2xl w-full h-auto object-cover">
            </div>
        </div>
    </section>

    <section id="why-us" class="py-20 bg-gray-100 relative overflow-hidden">
        <div class="container mx-auto px-8">
            <h2 class="text-5xl font-extrabold text-center text-gray-900 mb-6 section-header">Why Choose Learn Ease?</h2>
            <p class="text-xl text-center text-gray-700 mb-16 section-subheader">Experience a superior learning journey designed for your success.</p>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-12">
                <div class="bg-white rounded-2xl shadow-xl p-8 text-center border-b-4 border-blue-500 hover:shadow-2xl transition duration-300">
                    <img src="https://placehold.co/100x100/4a90e2/ffffff/webp?text=Expert" alt="Expert Instructors Icon" class="w-24 h-24 mx-auto mb-6 rounded-full border-4 border-blue-100 p-2 object-cover">
                    <h3 class="text-2xl font-bold text-gray-900 mb-3">Expert-Led Instruction</h3>
                    <p class="text-gray-700">Learn from seasoned professionals and industry leaders who bring real-world experience to the classroom.</p>
                </div>
                <div class="bg-white rounded-2xl shadow-xl p-8 text-center border-b-4 border-green-500 hover:shadow-2xl transition duration-300">
                    <img src="https://placehold.co/100x100/2ecc71/ffffff/webp?text=Hands-on" alt="Hands-on Learning Icon" class="w-24 h-24 mx-auto mb-6 rounded-full border-4 border-green-100 p-2 object-cover">
                    <h3 class="text-2xl font-bold text-gray-900 mb-3">Hands-on Learning</h3>
                    <p class="text-gray-700">Apply your knowledge through practical projects, coding challenges, and real-world case studies.</p>
                </div>
                <div class="bg-white rounded-2xl shadow-xl p-8 text-center border-b-4 border-purple-500 hover:shadow-2xl transition duration-300">
                    <img src="https://placehold.co/100x100/9b59b6/ffffff/webp?text=Support" alt="Community Support Icon" class="w-24 h-24 mx-auto mb-6 rounded-full border-4 border-purple-100 p-2 object-cover">
                    <h3 class="text-2xl font-bold text-gray-900 mb-3">Supportive Community</h3>
                    <p class="text-gray-700">Connect with fellow learners and instructors, get feedback, and collaborate on exciting projects.</p>
                </div>
            </div>
        </div>
        <div class="absolute top-1/3 right-0 w-64 h-64 bg-yellow-200 rounded-full mix-blend-multiply filter blur-xl opacity-30 animate-blob animation-delay-4000"></div>
        <div class="absolute bottom-1/3 left-0 w-72 h-72 bg-red-200 rounded-full mix-blend-multiply filter blur-xl opacity-30 animate-blob"></div>
    </section>

    <section id="uniqueness" class="py-20 bg-white">
        <div class="container mx-auto px-8 grid grid-cols-1 md:grid-cols-2 gap-16 items-center">
            <div>
                <img src="https://placehold.co/700x500/6a82fb/ffffff/webp?text=Unique+Approach" alt="Unique Approach" class="rounded-2xl shadow-2xl w-full h-auto object-cover">
            </div>
            <div>
                <h2 class="text-5xl font-extrabold text-gray-900 mb-6 section-header text-center md:text-left">Our Uniqueness</h2>
                <p class="text-xl text-gray-700 mb-6 leading-relaxed section-subheader text-center md:text-left">
                    What sets Learn Ease apart is our commitment to a truly adaptive and outcome-driven learning experience.
                </p>
                <ul class="text-lg text-gray-600 space-y-4 list-disc list-inside text-center md:text-left">
                    <li>
                        <strong class="text-blue-700">AI-Powered Personalization:</strong> Our platform adapts to your learning style and pace, recommending content and challenges tailored just for you.
                    </li>
                    <li>
                        <strong class="text-blue-700">Real-World Projects:</strong> Every course culminates in a portfolio-worthy project, giving you tangible proof of your skills.
                    </li>
                    <li>
                        <strong class="text-blue-700">Career Mentorship:</strong> Beyond certification, we offer dedicated career guidance, mock interviews, and job placement assistance.
                    </li>
                    <li>
                        <strong class="text-blue-700">Lifetime Access & Updates:</strong> Enroll once and get continuous access to course materials and future updates.
                    </li>
                </ul>
            </div>
        </div>
    </section>

    <section id="contact" class="py-20 bg-gray-800 text-white">
        <div class="container mx-auto px-8 text-center">
            <h2 class="text-5xl font-extrabold mb-6 section-header text-white">Get In Touch</h2>
            <p class="text-xl mb-12 section-subheader text-gray-300">Have questions? We're here to help!</p>
            <div class="max-w-3xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-12 text-left">
                <div>
                    <h3 class="text-2xl font-bold mb-4 text-white">Contact Information</h3>
                    <p class="flex items-center mb-3 text-lg"><svg class="w-6 h-6 mr-3 text-blue-400" fill="currentColor" viewBox="0 0 20 20"><path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"></path><path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"></path></svg> info@learnease.com</p>
                    <p class="flex items-center mb-3 text-lg"><svg class="w-6 h-6 mr-3 text-blue-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M14.243 5.757a6 6 0 10-.987 9.816l.01.011-.005.006 1.414 1.414.004-.005a8.002 8.002 0 00-12.028-11.332L6.172 6.172a4 4 0 015.656 5.656L10 14.343a1 1 0 101.414 1.414l1.414-1.414a6.002 6.002 0 00-1.415-8.485zM6.172 6.172L6 6.343l.707.707.01-.011.004-.005a.5.5 0 00-.707-.707z" clip-rule="evenodd"></path></svg> +1 (123) 456-7890</p>
                    <p class="flex items-center text-lg"><svg class="w-6 h-6 mr-3 text-blue-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"></path></svg> 123 Learning Lane, Knowledge City, World</p>
                </div>
                <form class="space-y-6">
                    <div>
                        <label for="contact-name" class="block text-lg font-medium text-gray-300 mb-2">Name</label>
                        <input type="text" id="contact-name" class="w-full px-5 py-3 rounded-lg bg-gray-700 border border-gray-600 focus:ring-blue-500 focus:border-blue-500 text-white" placeholder="Your Name" required>
                    </div>
                    <div>
                        <label for="contact-email" class="block text-lg font-medium text-gray-300 mb-2">Email</label>
                        <input type="email" id="contact-email" class="w-full px-5 py-3 rounded-lg bg-gray-700 border border-gray-600 focus:ring-blue-500 focus:border-blue-500 text-white" placeholder="your.email@example.com" required>
                    </div>
                    <div>
                        <label for="contact-message" class="block text-lg font-medium text-gray-300 mb-2">Message</label>
                        <textarea id="contact-message" rows="5" class="w-full px-5 py-3 rounded-lg bg-gray-700 border border-gray-600 focus:ring-blue-500 focus:border-blue-500 text-white" placeholder="Your message..." required></textarea>
                    </div>
                    <button type="submit" class="w-full px-8 py-4 bg-blue-600 text-white font-bold text-xl rounded-lg shadow-lg hover:bg-blue-700 transition duration-300 transform hover:scale-105">Send Message</button>
                </form>
            </div>
        </div>
        <div class="absolute bottom-0 left-1/4 w-96 h-96 bg-purple-200 rounded-full mix-blend-multiply filter blur-xl opacity-30 animate-blob animation-delay-6000"></div>
    </section>

    <div id="main-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>

            <div id="course-detail-view" class="w-full hidden">
                <h2 id="modal-course-title" class="text-4xl font-extrabold text-gray-900 mb-6"></h2>
                <div id="course-status-area" class="mb-6">
                    </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div>
                        <h3 class="text-2xl font-bold text-blue-700 mb-3">About the Course</h3>
                        <p id="modal-course-description" class="text-gray-700 leading-relaxed mb-6 text-lg"></p>

                        <h3 class="text-2xl font-bold text-blue-700 mb-3">Key Learnings</h3>
                        <ul id="modal-course-learnings" class="list-disc list-inside text-gray-700 mb-6 space-y-2 text-lg">
                        </ul>
                    </div>
                    <div>
                        <h3 class="text-2xl font-bold text-blue-700 mb-3">Course Details</h3>
                        <p class="text-gray-700 mb-2 text-lg"><span class="font-semibold">Duration:</span> <span id="modal-course-duration"></span></p>
                        <p class="text-gray-700 mb-2 text-lg"><span class="font-semibold">Fees:</span> <span id="modal-course-fees" class="text-green-600 font-bold"></span></p>
                        <p class="text-gray-700 mb-2 text-lg"><span class="font-semibold">Instructor:</span> <span id="modal-course-instructor"></span></p>
                        <p class="text-gray-700 mb-6 text-lg"><span class="font-semibold">Next Batch:</span> <span id="modal-course-batch"></span></p>

                        <h3 class="text-2xl font-bold text-blue-700 mb-3">Curriculum Highlights</h3>
                        <ul id="modal-course-curriculum" class="list-disc list-inside text-gray-700 space-y-2 text-lg">
                            </ul>

                        <button id="enroll-button" class="mt-8 w-full px-8 py-4 bg-blue-700 text-white font-bold text-xl rounded-xl shadow-lg hover:bg-blue-800 transition duration-300 transform hover:scale-105 hidden">
                            Enroll in Course
                        </button>
                        <button id="continue-learning-button" class="mt-8 w-full px-8 py-4 bg-blue-700 text-white font-bold text-xl rounded-xl shadow-lg hover:bg-blue-800 transition duration-300 transform hover:scale-105 hidden">
                            Continue Learning
                        </button>

                        <div id="llm-buttons-container" class="mt-8 space-y-4 hidden">
                            <button id="generate-study-plan-button" class="w-full px-8 py-4 bg-blue-700 text-white font-bold text-xl rounded-xl shadow-lg hover:bg-blue-800 transition duration-300 transform hover:scale-105">
                                ✨ Generate Study Plan
                            </button>
                            <div id="study-plan-output" class="mt-8 p-6 bg-gray-50 rounded-xl border border-gray-200 hidden">
                                <h3 class="text-2xl font-bold text-gray-900 mb-4">Your Personalized Study Plan</h3>
                                <div id="study-plan-content" class="text-gray-700 leading-relaxed text-base">
                                </div>
                                <div id="study-plan-loading" class="text-center text-blue-700 mt-4 hidden">
                                    <svg class="animate-spin h-8 w-8 text-blue-700 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                    </svg>
                                    <p class="mt-2">Generating your study plan...</p>
                                </div>
                            </div>

                            <button id="generate-faq-button" class="w-full px-8 py-4 bg-teal-600 text-white font-bold text-xl rounded-xl shadow-lg hover:bg-teal-700 transition duration-300 transform hover:scale-105">
                                ❓ Generate Course FAQ
                            </button>
                            <div id="faq-output" class="mt-8 p-6 bg-gray-50 rounded-xl border border-gray-200 hidden">
                                <h3 class="text-2xl font-bold text-gray-900 mb-4">Frequently Asked Questions</h3>
                                <div id="faq-content" class="text-gray-700 leading-relaxed text-base">
                                </div>
                                <div id="faq-loading" class="text-center text-teal-600 mt-4 hidden">
                                    <svg class="animate-spin h-8 w-8 text-teal-600 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                    </svg>
                                    <p class="mt-2">Generating FAQs...</p>
                                </div>
                            </div>

                            <button id="generate-career-path-button" class="w-full px-8 py-4 bg-amber-500 text-blue-900 font-bold text-xl rounded-xl shadow-lg hover:bg-amber-600 transition duration-300 transform hover:scale-105">
                                ✨ Generate Career Path Suggestions
                            </button>
                            <div id="career-path-output" class="mt-8 p-6 bg-gray-50 rounded-xl border border-gray-200 hidden">
                                <h3 class="text-2xl font-bold text-gray-900 mb-4">Suggested Career Paths</h3>
                                <div id="career-path-content" class="text-gray-700 leading-relaxed text-base">
                                </div>
                                <div id="career-path-loading" class="text-center text-amber-500 mt-4 hidden">
                                    <svg class="animate-spin h-8 w-8 text-amber-500 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                    </svg>
                                    <p class="mt-2">Generating career path suggestions...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="auth-forms-view" class="w-full hidden">
                <div class="max-w-md mx-auto p-8 bg-white rounded-2xl shadow-xl text-gray-800">
                    <h2 id="auth-form-title" class="text-3xl font-bold text-center text-gray-900 mb-6">Login</h2>
                    <form id="auth-form" class="space-y-6">
                        <div>
                            <label for="auth-email" class="block text-lg font-medium text-gray-700 mb-2 text-left">Email</label>
                            <input type="email" id="auth-email" class="w-full px-5 py-3 border border-gray-300 rounded-xl focus:ring-blue-600 focus:border-blue-600 transition duration-200" placeholder="your.email@example.com" required>
                        </div>
                        <div>
                            <label for="auth-password" class="block text-lg font-medium text-gray-700 mb-2 text-left">Password</label>
                            <input type="password" id="auth-password" class="w-full px-5 py-3 border border-gray-300 rounded-xl focus:ring-blue-600 focus:border-blue-600 transition duration-200" placeholder="********" required>
                        </div>
                        <button type="submit" id="auth-submit-button" class="w-full px-8 py-4 bg-blue-700 text-white font-bold text-xl rounded-xl shadow-lg hover:bg-blue-800 transition duration-300 transform hover:scale-105">Login</button>
                        <p id="auth-message" class="text-center text-red-600 mt-4"></p>
                    </form>
                    <p class="text-center mt-6 text-gray-600">
                        <span id="auth-toggle-text">Don't have an account?</span>
                        <button type="button" id="auth-toggle-button" class="text-blue-700 hover:underline font-semibold ml-1">Sign Up</button>
                    </p>
                </div>
            </div>

            <div id="image-upload-view" class="w-full hidden">
                <div class="max-w-md mx-auto p-8 bg-white rounded-2xl shadow-xl text-gray-800">
                    <h2 class="text-3xl font-bold text-center text-gray-900 mb-6">Upload Profile Image</h2>
                    <input type="file" id="image-file-input" accept="image/*" class="w-full px-5 py-3 border border-gray-300 rounded-xl focus:ring-blue-600 focus:border-blue-600 transition duration-200 mb-4">
                    <div id="image-preview-container" class="mb-4 hidden">
                        <img id="image-preview" class="max-w-full h-48 object-contain mx-auto rounded-lg border border-gray-300 p-2" src="">
                    </div>
                    <button type="button" id="upload-file-button" class="w-full px-8 py-4 bg-green-600 text-white font-bold text-xl rounded-xl shadow-lg hover:bg-green-700 transition duration-300 transform hover:scale-105">Upload Image</button>
                    <div id="upload-loading" class="text-center text-green-600 mt-4 hidden">
                        <svg class="animate-spin h-8 w-8 text-green-600 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        <p class="mt-2">Uploading image...</p>
                    </div>
                    <p id="upload-message" class="text-center mt-4"></p>
                </div>
            </div>

            <div id="my-courses-view" class="w-full hidden">
                <div class="max-w-4xl mx-auto p-8 bg-white rounded-2xl shadow-xl text-gray-800">
                    <h2 class="text-3xl font-bold text-center text-gray-900 mb-8">My Enrolled Courses</h2>
                    <div id="enrolled-courses-list" class="space-y-6">
                        <p class="text-center text-gray-600">Loading your courses...</p>
                    </div>
                </div>
            </div>

            <div id="chatbot-view" class="w-full hidden">
                <div class="max-w-xl mx-auto p-4 bg-white rounded-2xl shadow-xl text-gray-800">
                    <h2 class="text-3xl font-bold text-center text-gray-900 mb-6">Learn Ease AI Chatbot</h2>
                    <div id="chatbot-container">
                        <div id="chat-messages" class="flex flex-col space-y-2">
                            <div class="chat-message ai">Hello! How can I assist you with your learning journey today?</div>
                        </div>
                        <div id="chat-loading" class="hidden">
                            <svg class="animate-spin h-5 w-5 mr-3" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                            <span>AI is typing...</span>
                        </div>
                        <div id="chat-input-container">
                            <input type="text" id="chat-input" placeholder="Ask me anything about Learn Ease courses..." class="flex-grow">
                            <button id="chat-send-button">Send</button>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <footer class="bg-gray-900 text-gray-300 py-12">
        <div class="container mx-auto px-6 grid grid-cols-1 md:grid-cols-4 gap-8">
            <div>
                <h3 class="text-xl font-bold text-white mb-4">Learn Ease</h3>
                <p class="text-gray-400 mb-4">Empowering your future with trending skills and expert-led education.</p>
                <div class="flex space-x-4">
                    <a href="#" class="text-gray-400 hover:text-white transition duration-300 text-sm">Privacy Policy</a>
                    <a href="#" class="text-gray-400 hover:text-white transition duration-300 text-sm">Terms of Service</a>
                </div>
            </div>

            <div>
                <h3 class="text-xl font-bold text-white mb-4">Quick Links</h3>
                <ul class="space-y-2">
                    <li><a href="#home" class="text-gray-400 hover:text-white transition duration-300">Home</a></li>
                    <li><a href="#courses" class="text-gray-400 hover:text-white transition duration-300">Courses</a></li>
                    <li><a href="#about" class="text-gray-400 hover:text-white transition duration-300">About Us</a></li>
                    <li><a href="#contact" class="text-gray-400 hover:text-white transition duration-300">Contact Us</a></li>
                </ul>
            </div>

            <div>
                <h3 class="text-xl font-bold text-white mb-4">Popular Courses</h3>
                <ul class="space-y-2">
                    <li><a href="#" class="text-gray-400 hover:text-white transition duration-300">Data Science</a></li>
                    <li><a href="#" class="text-gray-400 hover:text-white transition duration-300">Web Development</a></li>
                    <li><a href="#" class="text-gray-400 hover:text-white transition duration-300">AI & Machine Learning</a></li>
                    <li><a href="#" class="text-gray-400 hover:text-white transition duration-300">Digital Marketing</a></li>
                </ul>
            </div>

            <div>
                <h3 class="text-xl font-bold text-white mb-4">Newsletter</h3>
                <p class="text-gray-400 mb-4">Stay updated with our latest courses and offers.</p>
                <form class="flex">
                    <input type="email" placeholder="Your Email" class="px-4 py-2 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-blue-600 bg-gray-800 text-white w-full">
                    <button type="submit" class="bg-blue-700 text-white px-5 py-2 rounded-r-lg hover:bg-blue-800 transition duration-300">Subscribe</button>
                </form>
            </div>
        </div>
        <div class="border-t border-gray-700 mt-12 pt-8 text-center text-gray-500 text-sm">
            &copy; 2024 Learn Ease. All rights reserved.
            <p id="user-status" class="mt-2 text-gray-400 flex items-center justify-center">
                <span id="profile-image-container" class="w-8 h-8 rounded-full overflow-hidden mr-2 hidden">
                    <img id="profile-image" class="w-full h-full object-cover" src="" alt="User Profile">
                </span>
                Not logged in.
            </p>
        </div>
    </footer>

    <script type="module">
        // Firebase Imports: These lines import necessary modules from the Firebase SDK.
        // They allow the application to interact with Firebase Authentication, Firestore Database, and Storage services.
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js"; // Core Firebase app initialization.
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js"; // Authentication related functions.
        import { getFirestore, doc, setDoc, getDoc, collection, getDocs, updateDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js"; // Firestore database operations.
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-storage.js"; // Firebase Storage for file uploads.

        // Firebase Configuration (provided by Canvas environment):
        // These global variables are automatically injected into the Canvas environment.
        // They contain the necessary credentials and unique identifiers for your Firebase project.
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id'; // Unique application ID for Firestore paths.
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {}; // Firebase project configuration.
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null; // Custom authentication token for initial sign-in.

        // Global Firebase variables: These will hold the initialized Firebase service instances.
        // They are declared globally so they can be accessed by various functions throughout the script.
        let app; // The initialized Firebase app instance.
        let db; // The Firestore database instance.
        let auth; // The Firebase Authentication instance.
        let storage; // The Firebase Storage instance.
        let currentUserId = null; // Stores the User ID (UID) of the currently logged-in user.
        let currentCourseId = null; // Stores the ID of the course currently being viewed in the modal, used for LLM features.

        // DOMContentLoaded Event Listener: Ensures that all JavaScript code runs only after the entire HTML document has been fully loaded and parsed.
        // This prevents errors where scripts try to access or manipulate DOM elements that do not yet exist.
        document.addEventListener('DOMContentLoaded', () => {
            console.log("DOMContentLoaded fired. Initializing application logic.");

            // Firebase Initialization: Attempt to initialize Firebase services.
            try {
                app = initializeApp(firebaseConfig); // Initialize the Firebase app with the provided configuration.
                db = getFirestore(app); // Get the Firestore database service instance.
                auth = getAuth(app); // Get the Authentication service instance.
                storage = getStorage(app); // Get the Storage service instance.
                console.log("Firebase initialized successfully within DOMContentLoaded.");
            } catch (error) {
                // Log any errors during Firebase initialization and update the user status.
                console.error("Error initializing Firebase:", error);
                const userStatusElement = document.getElementById('user-status');
                if (userStatusElement) {
                    userStatusElement.textContent = 'Firebase initialization failed. Check console for details.';
                }
                return; // Stop further execution if Firebase fails to initialize.
            }

            // --- Global Modal Management ---
            // Get references to the main modal container and its close button.
            const mainModal = document.getElementById('main-modal');
            const closeButton = mainModal ? mainModal.querySelector('.close-button') : null;

            // A map of all possible modal view sections. This allows for easy switching between different modal contents.
            const allModalViews = {
                courseDetail: document.getElementById('course-detail-view'),
                authForms: document.getElementById('auth-forms-view'),
                imageUpload: document.getElementById('image-upload-view'),
                myCourses: document.getElementById('my-courses-view'),
                chatbot: document.getElementById('chatbot-view'),
                payment: document.getElementById('payment-view') // Added for the new payment page.
            };

            /**
             * Displays a specific modal view and hides all other modal views.
             * It also manages the modal's visibility and transition effects.
             * @param {string} viewId - The ID of the modal view to show (e.g., 'courseDetail', 'authForms').
             */
            function showModalView(viewId) {
                // First, hide all existing modal views to ensure only one is active at a time.
                for (const key in allModalViews) {
                    if (allModalViews[key]) {
                        allModalViews[key].classList.add('hidden'); // Add 'hidden' class to conceal the view.
                    }
                }
                // Then, show the requested view.
                if (allModalViews[viewId]) {
                    allModalViews[viewId].classList.remove('hidden'); // Remove 'hidden' to make the specific view visible.
                    mainModal.classList.remove('hidden'); // Ensure the main modal container itself is not hidden.
                    mainModal.style.display = 'flex'; // Set display to 'flex' to enable centering via flexbox properties.
                    // A small delay is added using setTimeout to allow the CSS 'display' change to register
                    // before the 'show' class is added, ensuring the CSS transition for opacity and transform applies smoothly.
                    setTimeout(() => {
                        mainModal.classList.add('show'); // Add 'show' class to trigger fade-in and slide-in animations.
                    }, 10);
                } else {
                    console.error(`Modal view '${viewId}' not found.`); // Log an error if the requested view ID is invalid.
                }
                console.log(`Showing modal view: ${viewId}`); // Confirm which modal view is being displayed.
            }

            // Initialize modal state on page load: Ensure the main modal starts hidden.
            if (mainModal) {
                mainModal.classList.add('hidden'); // Add 'hidden' class to the main modal container.
                mainModal.style.display = 'none'; // Explicitly set display to 'none' to ensure it's not visible initially.
            }

            // Event listener for the modal's close button.
            if (closeButton) {
                closeButton.addEventListener('click', () => {
                    mainModal.classList.remove('show'); // Remove 'show' class to trigger fade-out/slide-out transition.
                    // After the CSS transition completes, set display to 'none' and re-add 'hidden' class.
                    // This ensures the modal is fully removed from the layout and no longer receives pointer events.
                    mainModal.addEventListener('transitionend', function handler() {
                        mainModal.style.display = 'none'; // Hide the modal completely.
                        mainModal.classList.add('hidden'); // Add 'hidden' class back.
                        mainModal.removeEventListener('transitionend', handler); // Remove this specific listener to prevent memory leaks.
                    }, { once: true }); // The listener will execute only once.
                    console.log("Closing modal.");
                });
            }

            // Event listener for clicking outside the modal content (backdrop click).
            window.addEventListener('click', (event) => {
                if (event.target === mainModal) { // Check if the click event originated directly on the modal backdrop.
                    mainModal.classList.remove('show'); // Initiate closing transition.
                    mainModal.addEventListener('transitionend', function handler() {
                        mainModal.style.display = 'none';
                        mainModal.classList.add('hidden');
                        mainModal.removeEventListener('transitionend', handler);
                    }, { once: true });
                    console.log("Closing modal via backdrop click.");
                }
            });

            // Event listener for the Escape key to close the modal.
            document.addEventListener('keydown', (event) => {
                if (event.key === 'Escape' && mainModal.classList.contains('show')) { // Check if modal is visible and Escape key was pressed.
                    mainModal.classList.remove('show'); // Initiate closing transition.
                    mainModal.addEventListener('transitionend', function handler() {
                        mainModal.style.display = 'none';
                        mainModal.classList.add('hidden');
                        mainModal.removeEventListener('transitionend', handler);
                    }, { once: true });
                    console.log("Closing modal via Escape key.");
                }
            });

            // --- Auth State Change Listener ---
            // This listener is crucial for managing the UI based on the user's authentication status (logged in, logged out, anonymous).
            if (auth) { // Ensure the Firebase auth object is initialized before attaching the listener.
                onAuthStateChanged(auth, async (user) => {
                    console.log("Auth state changed. User:", user ? user.uid : "null");
                    // Get references to all relevant DOM elements that need to be updated based on auth state.
                    const userStatusElement = document.getElementById('user-status');
                    const loginButton = document.getElementById('login-button');
                    const signupButton = document.getElementById('signup-button');
                    const logoutButton = document.getElementById('logout-button');
                    const uploadImageButton = document.getElementById('upload-image-button');
                    const myCoursesButton = document.getElementById('my-courses-button');
                    const chatAiButton = document.getElementById('chat-ai-button');
                    const paymentButton = document.getElementById('payment-button'); // New payment button.
                    const profileImageContainer = document.getElementById('profile-image-container');
                    const profileImage = document.getElementById('profile-image');
                    const mobileMenuButton = document.getElementById('mobile-menu-button');
                    const navbarLinks = document.getElementById('navbar-links');

                    // Crucial check: Ensure all necessary elements exist before attempting to manipulate them.
                    // This prevents "Cannot read properties of null" errors if the DOM isn't fully ready or elements are missing.
                    if (!userStatusElement || !loginButton || !signupButton || !logoutButton || !uploadImageButton || !myCoursesButton || !chatAiButton || !paymentButton || !profileImageContainer || !profileImage || !mobileMenuButton || !navbarLinks) {
                        console.error("One or more navigation buttons/elements not found in DOM after auth state change. This might indicate a timing issue or missing elements.");
                        return; // Exit the function if critical elements are not found.
                    }

                    if (user) {
                        // User is logged in (either via email/password or custom token).
                        currentUserId = user.uid; // Store the user's UID for later use.
                        userStatusElement.innerHTML = `<span class="font-semibold">Logged in as:</span> ${user.email || 'Anonymous'} (ID: ${user.uid})`;
                        // Hide login/signup buttons and show user-specific feature buttons.
                        loginButton.classList.add('hidden');
                        signupButton.classList.add('hidden');
                        logoutButton.classList.remove('hidden');
                        uploadImageButton.classList.remove('hidden');
                        myCoursesButton.classList.remove('hidden');
                        chatAiButton.classList.remove('hidden');
                        paymentButton.classList.remove('hidden'); // Show payment button for logged-in users.
                        profileImageContainer.classList.remove('hidden');

                        // Fetch or create user profile data from Firestore.
                        const userProfileRef = doc(db, `artifacts/${appId}/users/${user.uid}/profile`, 'user_data');
                        try {
                            const userProfileSnap = await getDoc(userProfileRef);
                            if (userProfileSnap.exists()) {
                                // If profile exists, load profile image if available.
                                const userData = userProfileSnap.data();
                                if (userData.profileImageUrl) {
                                    profileImage.src = userData.profileImageUrl;
                                    profileImage.alt = "User Profile Picture";
                                } else {
                                    // Default placeholder if no image URL is set in the profile.
                                    profileImage.src = 'https://placehold.co/32x32/cccccc/333333?text=User';
                                    profileImage.alt = "Default User Profile Picture";
                                }
                            } else {
                                // If profile doesn't exist, set a default image and create a new profile document in Firestore.
                                profileImage.src = 'https://placehold.co/32x32/cccccc/333333?text=User';
                                profileImage.alt = "Default User Profile Picture";
                                await setDoc(userProfileRef, {
                                    uid: user.uid,
                                    email: user.email || 'anonymous', // Store email or 'anonymous' if not available.
                                    createdAt: new Date().toISOString() // Record the timestamp of profile creation.
                                }, { merge: true }); // Use merge: true to avoid overwriting other potential fields if they were added later.
                            }
                        } catch (error) {
                            console.error("Error fetching or creating user profile:", error);
                            profileImage.src = 'https://placehold.co/32x32/cccccc/333333?text=Error';
                            profileImage.alt = "Error loading profile picture";
                        }

                    } else {
                        // User is logged out.
                        currentUserId = null; // Clear the current user ID.
                        userStatusElement.textContent = 'Not logged in.'; // Update status message.
                        // Show login/signup buttons and hide user-specific feature buttons.
                        loginButton.classList.remove('hidden');
                        signupButton.classList.remove('hidden');
                        logoutButton.classList.add('hidden');
                        uploadImageButton.classList.add('hidden');
                        myCoursesButton.classList.add('hidden');
                        chatAiButton.classList.add('hidden');
                        paymentButton.classList.add('hidden'); // Hide payment button for logged-out users.
                        profileImageContainer.classList.add('hidden');
                        profileImage.src = ''; // Clear profile image source.
                        profileImage.alt = ''; // Clear profile image alt text.

                        // If no initial custom authentication token is provided, sign in anonymously.
                        // This ensures there's always an authenticated user (even if anonymous) for Firestore security rules.
                        if (!initialAuthToken) {
                            try {
                                await signInAnonymously(auth); // Attempt anonymous sign-in.
                                console.log("Signed in anonymously.");
                            } catch (error) {
                                console.error("Error signing in anonymously:", error);
                            }
                        }
                    }
                    // Mobile menu toggle: Close menu when auth state changes (e.g., after login/logout).
                    navbarLinks.classList.remove('open');
                });
            } else {
                console.error("Auth object is null. Cannot attach onAuthStateChanged listener.");
            }

            // Initial sign-in attempt with a custom token if available.
            // This is typically used in environments where a token is pre-generated by a backend.
            if (initialAuthToken && auth) {
                signInWithCustomToken(auth, initialAuthToken)
                    .then((userCredential) => {
                        console.log("Signed in with custom token:", userCredential.user.uid);
                    })
                    .catch((error) => {
                        console.error("Error signing in with custom token:", error);
                        // If custom token sign-in fails, fall back to anonymous sign-in.
                        signInAnonymously(auth)
                            .then(() => console.log("Signed in anonymously after custom token failure."))
                            .catch(anonError => console.error("Error signing in anonymously:", anonError));
                    });
            }

            // --- Mobile Menu Toggle ---
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const navbarLinks = document.getElementById('navbar-links');

            if (mobileMenuButton && navbarLinks) {
                mobileMenuButton.addEventListener('click', () => {
                    navbarLinks.classList.toggle('hidden'); // Toggle Tailwind's hidden class.
                    navbarLinks.classList.toggle('open'); // Toggle custom 'open' class for CSS transition.
                });
            } else {
                console.error("Mobile menu elements not found. Mobile menu functionality may be limited.");
            }

            // --- Authentication Forms Logic ---
            // Get references to authentication form elements.
            const authFormTitle = document.getElementById('auth-form-title');
            const authSubmitButton = document.getElementById('auth-submit-button');
            const authToggleText = document.getElementById('auth-toggle-text');
            const authToggleButton = document.getElementById('auth-toggle-button');
            const authForm = document.getElementById('auth-form');
            const authMessage = document.getElementById('auth-message');
            const authEmailInput = document.getElementById('auth-email');
            const authPasswordInput = document.getElementById('auth-password');

            // Flag to ensure the submit listener is attached only once to the form.
            let authFormSubmitListenerAttached = false;

            // Check if all essential auth form elements exist.
            if (authForm && authEmailInput && authPasswordInput && authMessage && authFormTitle && authSubmitButton && authToggleText && authToggleButton) {
                /**
                 * Sets up the authentication form for either login or sign-up.
                 * @param {boolean} isLogin - True for login form, false for sign-up form.
                 */
                const setupAuthForm = (isLogin) => {
                    authFormTitle.textContent = isLogin ? 'Login' : 'Sign Up'; // Update title.
                    authSubmitButton.textContent = isLogin ? 'Login' : 'Sign Up'; // Update button text.
                    authToggleText.textContent = isLogin ? "Don't have an account?" : "Already have an account?"; // Update toggle text.
                    authToggleButton.textContent = isLogin ? 'Sign Up' : 'Login'; // Update toggle button text.
                    authMessage.textContent = ''; // Clear any previous messages.
                    authEmailInput.value = ''; // Clear email input.
                    authPasswordInput.value = ''; // Clear password input.

                    // Attach the submit listener only once.
                    if (!authFormSubmitListenerAttached) {
                        authForm.addEventListener('submit', async (e) => {
                            e.preventDefault(); // Prevent default form submission.
                            const email = authEmailInput.value;
                            const password = authPasswordInput.value;
                            authMessage.textContent = ''; // Clear message before new attempt.
                            console.log(`Attempting ${authSubmitButton.textContent} for ${email}`);

                            try {
                                if (authSubmitButton.textContent === 'Login') { // Check current button text to determine action.
                                    await signInWithEmailAndPassword(auth, email, password); // Firebase login.
                                    authMessage.textContent = 'Logged in successfully!';
                                } else {
                                    const userCredential = await createUserWithEmailAndPassword(auth, email, password); // Firebase sign-up.
                                    const user = userCredential.user;
                                    // Create a user profile document in Firestore upon successful sign-up.
                                    const userDocRef = doc(db, `artifacts/${appId}/users/${user.uid}/profile`, 'user_data');
                                    await setDoc(userDocRef, {
                                        uid: user.uid,
                                        email: user.email,
                                        createdAt: new Date().toISOString()
                                    }, { merge: true });
                                    authMessage.textContent = 'Account created and logged in!';
                                }
                                authMessage.classList.remove('text-red-600'); // Remove error styling.
                                authMessage.classList.add('text-green-600'); // Add success styling.
                                // Close modal after a short delay for success message to be seen.
                                setTimeout(() => mainModal.classList.remove('show'), 1500);
                            } catch (error) {
                                authMessage.textContent = `${authSubmitButton.textContent} failed: ${error.message}`; // Display error message.
                                authMessage.classList.remove('text-green-600'); // Remove success styling.
                                authMessage.classList.add('text-red-600'); // Add error styling.
                                console.error(`${authSubmitButton.textContent} Error:`, error);
                            }
                        });
                        authFormSubmitListenerAttached = true; // Set flag to true after attaching.
                    }
                };

                // Event listener for toggling between login and sign-up forms.
                authToggleButton.addEventListener('click', () => {
                    const currentIsLogin = authSubmitButton.textContent === 'Login'; // Check current state.
                    setupAuthForm(!currentIsLogin); // Toggle state.
                    console.log(`Toggling auth form to: ${!currentIsLogin ? 'Sign Up' : 'Login'}`);
                });

                // Event listener for the main navigation "Login" button.
                document.getElementById('login-button').addEventListener('click', () => {
                    showModalView('authForms'); // Show the authentication modal.
                    setupAuthForm(true); // Configure it for login.
                    console.log("Login button clicked.");
                });

                // Event listener for the main navigation "Sign Up" button.
                document.getElementById('signup-button').addEventListener('click', () => {
                    showModalView('authForms'); // Show the authentication modal.
                    setupAuthForm(false); // Configure it for sign-up.
                    console.log("Sign Up button clicked.");
                });

                // Event listener for the "Logout" button.
                document.getElementById('logout-button').addEventListener('click', async () => {
                    try {
                        await signOut(auth); // Sign out the current user from Firebase.
                        console.log("User logged out successfully.");
                    } catch (error) {
                        console.error("Error logging out:", error);
                    }
                });
            } else {
                console.error("Auth form elements not found. Authentication features may not work.");
            }

            // --- Image Upload Logic ---
            const uploadImageButton = document.getElementById('upload-image-button');
            if (uploadImageButton) { // Check if the upload image button exists.
                uploadImageButton.addEventListener('click', () => {
                    // Prevent anonymous users from uploading images.
                    if (!auth.currentUser || auth.currentUser.isAnonymous) {
                        showModalView('authForms');
                        authMessage.textContent = 'Please log in with an email account to upload an image.';
                        authMessage.classList.add('text-red-600');
                        return;
                    }
                    showModalView('imageUpload'); // Show the image upload modal.

                    // Get references to image upload modal elements.
                    const imageFileInput = document.getElementById('image-file-input');
                    const imagePreview = document.getElementById('image-preview');
                    const imagePreviewContainer = document.getElementById('image-preview-container');
                    const uploadFileButton = document.getElementById('upload-file-button');
                    const uploadLoading = document.getElementById('upload-loading');
                    const uploadMessage = document.getElementById('upload-message');

                    // Reset modal state when opened.
                    imageFileInput.value = ''; // Clear selected file.
                    imagePreview.src = ''; // Clear image preview.
                    imagePreviewContainer.classList.add('hidden'); // Hide preview container.
                    uploadMessage.textContent = ''; // Clear messages.
                    uploadLoading.classList.add('hidden'); // Hide loading indicator.

                    // Event listener for file input change (when a file is selected).
                    imageFileInput.onchange = (event) => {
                        const file = event.target.files[0]; // Get the selected file.
                        if (file) {
                            const reader = new FileReader(); // Create a FileReader to read the file.
                            reader.onload = (e) => {
                                imagePreview.src = e.target.result; // Set preview image source.
                                imagePreviewContainer.classList.remove('hidden'); // Show preview container.
                            };
                            reader.readAsDataURL(file); // Read file as Data URL.
                        } else {
                            imagePreview.src = '';
                            imagePreviewContainer.classList.add('hidden');
                        }
                        uploadMessage.textContent = ''; // Clear any previous upload messages.
                    };

                    // Event listener for the upload button click.
                    uploadFileButton.onclick = async () => {
                        const file = imageFileInput.files[0]; // Get the file to upload.
                        if (!file) {
                            uploadMessage.textContent = 'Please select an image to upload.';
                            uploadMessage.className = 'text-center mt-4 text-red-600';
                            return;
                        }

                        if (!auth.currentUser) {
                            uploadMessage.textContent = 'You must be logged in to upload an image.';
                            uploadMessage.className = 'text-center mt-4 text-red-600';
                            return;
                        }

                        uploadLoading.classList.remove('hidden'); // Show loading indicator.
                        uploadMessage.textContent = ''; // Clear messages.

                        try {
                            const userId = auth.currentUser.uid;
                            // Create a storage reference for the profile image.
                            const imageRef = ref(storage, `artifacts/${appId}/users/${userId}/profile_images/profile.jpg`);

                            await uploadBytes(imageRef, file); // Upload the file to Firebase Storage.

                            const imageUrl = await getDownloadURL(imageRef); // Get the public URL of the uploaded image.
                            console.log("Image uploaded, URL:", imageUrl);

                            // Update the user's profile document in Firestore with the new image URL.
                            const userDocRef = doc(db, `artifacts/${appId}/users/${userId}/profile`, 'user_data');
                            await setDoc(userDocRef, { profileImageUrl: imageUrl }, { merge: true });

                            uploadMessage.textContent = 'Image uploaded successfully!';
                            uploadMessage.className = 'text-center mt-4 text-green-600';
                            // Update the profile image displayed in the navbar.
                            document.getElementById('profile-image').src = imageUrl;
                            document.getElementById('profile-image').alt = "User Profile Picture";
                            document.getElementById('profile-image-container').classList.remove('hidden');

                            setTimeout(() => mainModal.classList.remove('show'), 1500); // Close modal after success.
                        } catch (error) {
                            uploadMessage.textContent = `Upload failed: ${error.message}`;
                            uploadMessage.className = 'text-center mt-4 text-red-600';
                            console.error("Image upload error:", error);
                        } finally {
                            uploadLoading.classList.add('hidden'); // Hide loading indicator.
                        }
                    };
                });
            }

            // --- My Courses Logic ---
            const myCoursesButton = document.getElementById('my-courses-button');
            if (myCoursesButton) { // Check if the "My Courses" button exists.
                myCoursesButton.addEventListener('click', async () => {
                    // Prevent anonymous users from viewing enrolled courses.
                    if (!auth.currentUser || auth.currentUser.isAnonymous) {
                        showModalView('authForms');
                        authMessage.textContent = 'Please log in to view your enrolled courses.';
                        authMessage.classList.add('text-red-600');
                        return;
                    }

                    showModalView('myCourses'); // Show the "My Courses" modal view.
                    const enrolledCoursesList = document.getElementById('enrolled-courses-list');
                    enrolledCoursesList.innerHTML = '<p class="text-center text-gray-600">Loading your courses...</p>'; // Show loading message.

                    try {
                        // Fetch enrollments for the current user from Firestore.
                        const enrollmentsRef = collection(db, `artifacts/${appId}/users/${auth.currentUser.uid}/enrollments`);
                        const querySnapshot = await getDocs(enrollmentsRef);

                        let coursesHtml = '';
                        if (querySnapshot.empty) {
                            // Display message if no courses are enrolled.
                            coursesHtml = '<p class="text-center text-gray-600 text-lg">You haven\'t enrolled in any courses yet. Explore our <a href="#courses" class="text-blue-700 hover:underline" onclick="document.getElementById(\'main-modal\').classList.remove(\'show\');">courses</a> to get started!</p>';
                        } else {
                            // Iterate through enrolled courses and build HTML for each.
                            querySnapshot.forEach(docSnap => {
                                const enrollmentData = docSnap.data();
                                const enrolledCourseId = enrollmentData.courseId;
                                const courseDetails = coursesData[enrolledCourseId]; // Get course details from local data.

                                if (courseDetails) {
                                    const moduleProgress = enrollmentData.progress || {};
                                    const totalModules = courseDetails.modules ? courseDetails.modules.length : 0;
                                    let completedModules = 0;

                                    if (totalModules > 0) {
                                        courseDetails.modules.forEach(module => {
                                            if (moduleProgress[module.id]) {
                                                completedModules++;
                                            }
                                        });
                                    }
                                    const completionPercentage = totalModules > 0 ? Math.round((completedModules / totalModules) * 100) : 0;

                                    // Append HTML for each enrolled course.
                                    coursesHtml += `
                                        <div class="bg-gray-50 rounded-xl shadow p-6 border border-gray-200">
                                            <h3 class="text-2xl font-bold text-gray-900 mb-2">${courseDetails.title}</h3>
                                            <p class="text-gray-700 mb-3">Instructor: ${courseDetails.instructor}</p>
                                            <p class="text-gray-700 mb-4">Progress: ${completionPercentage}%</p>
                                            <div class="w-full bg-gray-200 rounded-full h-3 mb-4">
                                                <div class="bg-blue-500 h-3 rounded-full" style="width: ${completionPercentage}%"></div>
                                            </div>
                                            <button class="px-6 py-2 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition duration-300" data-course-id="${enrolledCourseId}" onclick="openCourseDetailFromMyCourses(this.dataset.courseId)">
                                                View Course
                                            </button>
                                        </div>
                                    `;
                                }
                            });
                        }
                        enrolledCoursesList.innerHTML = coursesHtml; // Update the list with generated HTML.
                    } catch (error) {
                        console.error("Error fetching enrolled courses:", error);
                        enrolledCoursesList.innerHTML = '<p class="text-center text-red-600">Failed to load your courses. Please try again.</p>';
                    }
                });
            }

            /**
             * Helper function to reopen the course detail modal from the "My Courses" view.
             * This simulates a click on the corresponding course card.
             * @param {string} courseId - The ID of the course to open.
             */
            window.openCourseDetailFromMyCourses = async (courseId) => {
                mainModal.classList.remove('show'); // Close the current modal (My Courses).
                // Find the course card element and trigger its click event.
                const courseCard = document.querySelector(`.course-card[data-course-id="${courseId}"]`);
                if (courseCard) {
                    courseCard.click(); // Programmatically click the card to open its detail modal.
                } else {
                    console.error(`Course card with ID ${courseId} not found to open from My Courses.`);
                }
            };

            // --- Course Data (now with modules for progress tracking) ---
            // This object holds all the static data for the courses.
            const coursesData = {
                'data-science': {
                    title: 'Data Science Masterclass',
                    description: 'This comprehensive course covers everything from data collection and cleaning to advanced machine learning models. You will learn Python, R, SQL, data visualization, statistical analysis, and various machine learning algorithms. Ideal for aspiring data scientists and analysts.',
                    duration: '6 Months',
                    fees: '$1200',
                    instructor: 'Dr. Emily Chen',
                    batch: 'July 15, 2024',
                    learnings: [
                        'Fundamentals of Python and R for Data Science',
                        'Data Manipulation and Cleaning with Pandas/dplyr',
                        'Statistical Analysis and Hypothesis Testing',
                        'Machine Learning Algorithms (Regression, Classification, Clustering)',
                        'Deep Learning Basics with TensorFlow/PyTorch',
                        'Big Data Technologies (Hadoop, Spark)',
                        'Data Visualization with Matplotlib, Seaborn, ggplot2',
                        'SQL for Data Analysis'
                    ],
                    modules: [ // Detailed modules for progress tracking.
                        { id: 'ds-mod1', title: 'Introduction to Data Science & Python/R' },
                        { id: 'ds-mod2', title: 'Data Preprocessing & Exploratory Data Analysis' },
                        { id: 'ds-mod3', title: 'Statistical Foundations for Data Science' },
                        { id: 'ds-mod4', title: 'Machine Learning - Supervised Learning' },
                        { id: 'ds-mod5', title: 'Machine Learning - Unsupervised Learning' },
                        { id: 'ds-mod6', title: 'Introduction to Deep Learning' },
                        { id: 'ds-mod7', title: 'Big Data Ecosystem & Cloud Platforms' },
                        { id: 'ds-mod8', title: 'Capstone Project' }
                    ]
                },
                'web-development': {
                    title: 'Full Stack Web Development',
                    description: 'Become a proficient full-stack developer capable of building robust and scalable web applications. This course covers front-end development (HTML, CSS, JavaScript, React) and back-end development (Node.js, Express) with database integration (MongoDB).',
                    duration: '5 Months',
                    fees: '$1000',
                    instructor: 'Mr. Alex Rivera',
                    batch: 'Aug 1, 2024',
                    learnings: [
                        'HTML5, CSS3, and Responsive Design',
                        'Modern JavaScript (ES6+)',
                        'React.js for Front-end Development',
                        'Node.js and Express.js for Back-end APIs',
                        'MongoDB for Database Management',
                        'RESTful API Design and Integration',
                        'Authentication and Authorization',
                        'Deployment Strategies (Netlify, Heroku)'
                    ],
                    modules: [
                        { id: 'wd-mod1', title: 'Front-end Fundamentals (HTML, CSS, JS)' },
                        { id: 'wd-mod2', title: 'Advanced JavaScript & DOM Manipulation' },
                        { id: 'wd-mod3', title: 'React.js - Components, State, Hooks' },
                        { id: 'wd-mod4', title: 'React.js - Routing & State Management' },
                        { id: 'wd-mod5', title: 'Node.js & Express.js - Server-side Programming' },
                        { id: 'wd-mod6', title: 'MongoDB - Database Integration' },
                        { id: 'wd-mod7', title: 'Authentication & Deployment' },
                        { id: 'wd-mod8', title: 'Final Project' }
                    ]
                },
                'ai-ml': {
                    title: 'Artificial Intelligence & Machine Learning',
                    description: 'Explore the fascinating world of AI and Machine Learning. This course delves into foundational concepts, advanced algorithms, and practical applications using Python and popular libraries like scikit-learn and TensorFlow.',
                    duration: '7 Months',
                    fees: '$1500',
                    instructor: 'Dr. Sarah Lee',
                    batch: 'Sep 10, 2024',
                    learnings: [
                        'Introduction to AI and ML Concepts',
                        'Python for AI/ML (NumPy, Pandas, Matplotlib)',
                        'Supervised Learning (Linear Regression, Logistic Regression, SVM, Decision Trees)',
                        'Unsupervised Learning (K-Means, Hierarchical Clustering)',
                        'Neural Networks and Deep Learning Fundamentals',
                        'Convolutional Neural Networks (CNNs) for Image Processing',
                        'Recurrent Neural Networks (RNNs) for Sequence Data',
                        'Natural Language Processing (NLP) Basics'
                    ],
                    modules: [
                        { id: 'ai-mod1', title: 'AI/ML Overview & Python Setup' },
                        { id: 'ai-mod2', title: 'Data Preprocessing & Feature Engineering' },
                        { id: 'ai-mod3', title: 'Supervised Learning Algorithms' },
                        { id: 'ai-mod4', title: 'Unsupervised Learning & Dimensionality Reduction' },
                        { id: 'ai-mod5', title: 'Deep Learning with TensorFlow/Keras' },
                        { id: 'ai-mod6', title: 'Computer Vision Applications' },
                        { id: 'ai-mod7', title: 'Natural Language Processing' },
                        { id: 'ai-mod8', title: 'AI/ML Project' }
                    ]
                },
                'digital-marketing': {
                    title: 'Certified Digital Marketing Professional',
                    description: 'Master the art of digital marketing and drive online growth. This course covers SEO, SEM, social media marketing, content marketing, email marketing, and analytics to build effective digital campaigns.',
                    duration: '4 Months',
                    fees: '$800',
                    instructor: 'Ms. Olivia Brown',
                    batch: 'Oct 5, 2024',
                    learnings: [
                        'Search Engine Optimization (SEO) Strategies',
                        'Search Engine Marketing (SEM) & Google Ads',
                        'Social Media Marketing (Facebook, Instagram, LinkedIn)',
                        'Content Marketing & Strategy',
                        'Email Marketing Automation',
                        'Website Analytics with Google Analytics',
                        'Conversion Rate Optimization (CRO)',
                        'Mobile Marketing'
                    ],
                    modules: [
                        { id: 'dm-mod1', title: 'Introduction to Digital Marketing' },
                        { id: 'dm-mod2', title: 'Search Engine Optimization (SEO)' },
                        { id: 'dm-mod3', title: 'Search Engine Marketing (SEM)' },
                        { id: 'dm-mod4', title: 'Social Media Marketing' },
                        { id: 'dm-mod5', title: 'Content Marketing & Strategy' },
                        { id: 'dm-mod6', title: 'Email Marketing & Automation' },
                        { id: 'dm-mod7', title: 'Web Analytics & Reporting' },
                        { id: 'dm-mod8', title: 'Digital Marketing Campaign Planning' }
                    ]
                },
                'cloud-computing': {
                    title: 'Cloud Computing Fundamentals',
                    description: 'Gain a solid understanding of cloud computing concepts and popular platforms like AWS, Azure, and Google Cloud. Learn about cloud services, deployment models, and best practices for cloud infrastructure.',
                    duration: '5 Months',
                    fees: '$1100',
                    instructor: 'Mr. David Kim',
                    batch: 'Nov 1, 2024',
                    learnings: [
                        'Introduction to Cloud Computing & its Benefits',
                        'Cloud Service Models (IaaS, PaaS, SaaS)',
                        'Cloud Deployment Models (Public, Private, Hybrid)',
                        'AWS Core Services (EC2, S3, RDS, VPC)',
                        'Azure Fundamentals (Virtual Machines, Storage, Networking)',
                        'Google Cloud Platform Basics (Compute Engine, Cloud Storage)',
                        'Cloud Security Best Practices',
                        'Cost Management in Cloud'
                    ],
                    modules: [
                        { id: 'cc-mod1', title: 'Cloud Computing Overview' },
                        { id: 'cc-mod2', title: 'AWS Essentials' },
                        { id: 'cc-mod3', title: 'Microsoft Azure Basics' },
                        { id: 'cc-mod4', title: 'Google Cloud Platform Introduction' },
                        { id: 'cc-mod5', title: 'Cloud Security & Compliance' },
                        { id: 'cc-mod6', title: 'Cloud Networking & Storage' },
                        { id: 'cc-mod7', title: 'Serverless Computing' },
                        { id: 'cc-mod8', title: 'Cloud Migration Strategies' }
                    ]
                },
                'ui-ux-design': {
                    title: 'Professional UI/UX Design',
                    description: 'Learn to design intuitive and engaging user interfaces (UI) and user experiences (UX) for web and mobile applications. This course covers design principles, wireframing, prototyping, and user testing.',
                    duration: '4 Months',
                    fees: '$950',
                    instructor: 'Ms. Jessica Wong',
                    batch: 'Dec 1, 2024',
                    learnings: [
                        'Fundamentals of UI/UX Design',
                        'User Research & Persona Creation',
                        'Information Architecture & Wireframing',
                        'Prototyping with Figma/Adobe XD',
                        'Usability Testing & Feedback Integration',
                        'Visual Design Principles (Color, Typography, Layout)',
                        'Interaction Design & Animation',
                        'Design Systems & Accessibility'
                    ],
                    modules: [
                        { id: 'ui-mod1', title: 'Introduction to UI/UX' },
                        { id: 'ui-mod2', title: 'User Research & Analysis' },
                        { id: 'ui-mod3', title: 'Information Architecture & Wireframing' },
                        { id: 'ui-mod4', title: 'Prototyping & User Flows' },
                        { id: 'ui-mod5', title: 'Visual Design & Branding' },
                        { id: 'ui-mod6', title: 'Interaction Design & Animation' },
                        { id: 'ui-mod7', title: 'Usability Testing & Iteration' },
                        { id: 'ui-mod8', title: 'Building a UI/UX Portfolio' }
                    ]
                }
            };

            // --- Course Detail Logic ---
            const courseCards = document.querySelectorAll('.course-card'); // Select all course card elements.

            // Add click event listener to each course card.
            courseCards.forEach(card => {
                card.addEventListener('click', async () => {
                    const courseId = card.dataset.courseId; // Get the course ID from the data attribute.
                    console.log(`Course card clicked: ${courseId}`);
                    currentCourseId = courseId; // Set the global currentCourseId for LLM features.

                    const course = coursesData[courseId]; // Retrieve course data.
                    if (!course) {
                        console.error("Course data not found for ID:", courseId);
                        return;
                    }
                    showModalView('courseDetail'); // Show the course detail modal.

                    // Populate the modal with course details and manage enrollment state.
                    await populateCourseDetailModal(courseId);
                });
            });

            /**
             * Populates the course detail modal with dynamic content based on the course ID.
             * It also handles enrollment status and module progress.
             * @param {string} courseId - The ID of the course to display.
             */
            async function populateCourseDetailModal(courseId) {
                console.log(`Populating course detail modal for course: ${courseId}`);
                const course = coursesData[courseId];
                if (!course) {
                    console.error(`Course data not found for ID: ${courseId} in populateCourseDetailModal.`);
                    return;
                }

                // Get references to all elements within the course detail modal.
                const modalCourseTitle = document.getElementById('modal-course-title');
                const modalCourseDescription = document.getElementById('modal-course-description');
                const modalCourseDuration = document.getElementById('modal-course-duration');
                const modalCourseFees = document.getElementById('modal-course-fees');
                const modalCourseInstructor = document.getElementById('modal-course-instructor');
                const modalCourseBatch = document.getElementById('modal-course-batch');
                const modalCourseLearnings = document.getElementById('modal-course-learnings');
                const modalCourseCurriculum = document.getElementById('modal-course-curriculum');
                const courseStatusArea = document.getElementById('course-status-area');
                const enrollButton = document.getElementById('enroll-button');
                const continueLearningButton = document.getElementById('continue-learning-button');
                const llmButtonsContainer = document.getElementById('llm-buttons-container');

                const studyPlanOutputDiv = document.getElementById('study-plan-output');
                const studyPlanContentDiv = document.getElementById('study-plan-content');
                const studyPlanLoadingDiv = document.getElementById('study-plan-loading');
                const generateStudyPlanButton = document.getElementById('generate-study-plan-button');

                const faqOutputDiv = document.getElementById('faq-output');
                const faqContentDiv = document.getElementById('faq-content');
                const faqLoadingDiv = document.getElementById('faq-loading');
                const generateFaqButton = document.getElementById('generate-faq-button');

                const careerPathOutputDiv = document.getElementById('career-path-output');
                const careerPathContentDiv = document.getElementById('career-path-content');
                const careerPathLoadingDiv = document.getElementById('career-path-loading');
                const generateCareerPathButton = document.getElementById('generate-career-path-button');

                // Critical check: Ensure all necessary elements exist before trying to manipulate them.
                const elementsToCheck = [
                    modalCourseTitle, modalCourseDescription, modalCourseDuration, modalCourseFees,
                    modalCourseInstructor, modalCourseBatch, modalCourseLearnings, modalCourseCurriculum,
                    courseStatusArea, enrollButton, continueLearningButton, llmButtonsContainer,
                    studyPlanOutputDiv, studyPlanContentDiv, studyPlanLoadingDiv, generateStudyPlanButton,
                    faqOutputDiv, faqContentDiv, faqLoadingDiv, generateFaqButton,
                    careerPathOutputDiv, careerPathContentDiv, careerPathLoadingDiv, generateCareerPathButton
                ];

                for (const element of elementsToCheck) {
                    if (!element) {
                        console.error(`Missing DOM element in populateCourseDetailModal: ${element ? element.id : 'Unknown element'}`);
                        return; // Exit if a critical element is missing to prevent further errors.
                    }
                }

                // Populate basic course details.
                modalCourseTitle.textContent = course.title;
                modalCourseDescription.textContent = course.description;
                modalCourseDuration.textContent = course.duration;
                modalCourseFees.textContent = course.fees;
                modalCourseInstructor.textContent = course.instructor;
                modalCourseBatch.textContent = course.batch;

                // Populate key learnings list.
                modalCourseLearnings.innerHTML = ''; // Clear previous learnings.
                course.learnings.forEach(learning => {
                    const li = document.createElement('li');
                    li.textContent = learning;
                    modalCourseLearnings.appendChild(li);
                });

                // Hide LLM output areas initially.
                studyPlanOutputDiv.classList.add('hidden');
                studyPlanContentDiv.innerHTML = '';
                faqOutputDiv.classList.add('hidden');
                faqContentDiv.innerHTML = '';
                careerPathOutputDiv.classList.add('hidden');
                careerPathContentDiv.innerHTML = '';

                let isEnrolled = false;
                let enrollmentDocSnap;
                // Check enrollment status only if a user is logged in (not anonymous).
                if (auth.currentUser && !auth.currentUser.isAnonymous) {
                    const enrollmentRef = doc(db, `artifacts/${appId}/users/${auth.currentUser.uid}/enrollments`, courseId);
                    enrollmentDocSnap = await getDoc(enrollmentRef);
                    isEnrolled = enrollmentDocSnap.exists();
                    console.log(`User ${auth.currentUser.uid} enrollment status for ${courseId}: ${isEnrolled}`);
                } else {
                    console.log("User not logged in or is anonymous. Cannot check enrollment status.");
                }

                // Reset button visibility.
                enrollButton.classList.add('hidden');
                continueLearningButton.classList.add('hidden');
                llmButtonsContainer.classList.add('hidden');
                courseStatusArea.innerHTML = '';
                modalCourseCurriculum.innerHTML = ''; // Clear curriculum.

                if (isEnrolled) {
                    // If enrolled, show "Continue Learning" and LLM buttons.
                    continueLearningButton.classList.remove('hidden');
                    llmButtonsContainer.classList.remove('hidden');
                    console.log("User is enrolled. Showing 'Continue Learning' and LLM buttons.");

                    const enrollmentData = enrollmentDocSnap.data();
                    const moduleProgress = enrollmentData.progress || {};
                    const totalModules = course.modules ? course.modules.length : 0;
                    let completedModules = 0;

                    if (totalModules > 0) {
                        course.modules.forEach(module => {
                            if (moduleProgress[module.id]) {
                                completedModules++;
                            }
                        });
                    }
                    const completionPercentage = totalModules > 0 ? Math.round((completedModules / totalModules) * 100) : 0;

                    // Display course progress.
                    courseStatusArea.innerHTML = `
                        <p class="text-xl font-semibold text-gray-800 mb-2">Your Progress: ${completionPercentage}%</p>
                        <div class="w-full bg-gray-200 rounded-full h-4">
                            <div class="bg-blue-600 h-4 rounded-full" style="width: ${completionPercentage}%"></div>
                        </div>
                    `;

                    // Populate curriculum with module checkboxes for progress tracking.
                    if (course.modules) {
                        course.modules.forEach(module => {
                            const li = document.createElement('li');
                            li.className = 'flex items-center space-x-2 text-lg';
                            const checkboxId = `module-${courseId}-${module.id}`;
                            li.innerHTML = `
                                <input type="checkbox" id="${checkboxId}" data-module-id="${module.id}" class="h-5 w-5 text-blue-600 rounded focus:ring-blue-500 cursor-pointer">
                                <label for="${checkboxId}" class="text-gray-700 cursor-pointer">${module.title}</label>
                            `;
                            modalCourseCurriculum.appendChild(li);

                            const checkbox = document.getElementById(checkboxId);
                            if (checkbox) { // Ensure checkbox element exists.
                                if (moduleProgress[module.id]) {
                                    checkbox.checked = true; // Set checkbox state based on saved progress.
                                }

                                // Remove any existing listener to prevent duplicates when modal is repopulated.
                                const oldListener = checkbox.dataset.listener;
                                if (oldListener && window[oldListener]) {
                                    checkbox.removeEventListener('change', window[oldListener]);
                                }

                                // Attach a new change listener to the checkbox.
                                const newListenerName = `handleModuleChange_${courseId}_${module.id}`;
                                window[newListenerName] = async (event) => {
                                    if (!auth.currentUser) {
                                        showModalView('authForms');
                                        authMessage.textContent = 'Please log in to track progress.';
                                        authMessage.classList.add('text-red-600');
                                        event.target.checked = !event.target.checked; // Revert checkbox state if not logged in.
                                        return;
                                    }
                                    const moduleId = event.target.dataset.moduleId;
                                    const isCompleted = event.target.checked;
                                    const updateData = { [`progress.${moduleId}`]: isCompleted }; // Prepare update data for Firestore.
                                    const enrollmentRef = doc(db, `artifacts/${appId}/users/${auth.currentUser.uid}/enrollments`, courseId);

                                    try {
                                        await updateDoc(enrollmentRef, updateData); // Update document in Firestore.
                                        console.log(`Module ${moduleId} progress updated to ${isCompleted}`);

                                        // Re-calculate and update progress display.
                                        const updatedEnrollmentSnap = await getDoc(enrollmentRef);
                                        const updatedProgress = updatedEnrollmentSnap.data().progress || {};
                                        let updatedCompletedModules = 0;
                                        course.modules.forEach(m => {
                                            if (updatedProgress[m.id]) {
                                                updatedCompletedModules++;
                                            }
                                        });
                                        const updatedCompletionPercentage = totalModules > 0 ? Math.round((updatedCompletedModules / totalModules) * 100) : 0;
                                        courseStatusArea.innerHTML = `
                                            <p class="text-xl font-semibold text-gray-800 mb-2">Your Progress: ${updatedCompletionPercentage}%</p>
                                            <div class="w-full bg-gray-200 rounded-full h-4">
                                                <div class="bg-blue-600 h-4 rounded-full" style="width: ${updatedCompletionPercentage}%"></div>
                                            </div>
                                        `;

                                    } catch (error) {
                                        console.error("Error updating module progress:", error);
                                        courseStatusArea.insertAdjacentHTML('afterend', `<p class="text-center text-red-600 mt-2">Failed to update progress. Please try again.</p>`);
                                        event.target.checked = !event.target.checked; // Revert checkbox state on error.
                                    }
                                };
                                checkbox.addEventListener('change', window[newListenerName]); // Attach the new listener.
                                checkbox.dataset.listener = newListenerName; // Store listener name for future removal.
                            }
                        });
                    } else {
                        modalCourseCurriculum.innerHTML = '<p class="text-gray-600">No trackable modules for this course.</p>';
                    }

                } else { // Not enrolled in the course.
                    console.log("User is NOT enrolled. Showing 'Enroll' button or login prompt.");
                    if (auth.currentUser && !auth.currentUser.isAnonymous) {
                        enrollButton.classList.remove('hidden'); // Show enroll button if logged in.
                    } else {
                         courseStatusArea.innerHTML = `<p class="text-xl font-semibold text-red-600 mb-4 text-center">Please log in to enroll and access course features.</p>`;
                    }
                    modalCourseCurriculum.innerHTML = ''; // Clear curriculum area.
                    // For non-enrolled view, display learnings as curriculum highlights.
                    if (course.learnings) {
                        course.learnings.forEach(item => {
                            const li = document.createElement('li');
                            li.textContent = item;
                            modalCourseCurriculum.appendChild(li);
                        });
                    } else {
                        modalCourseCurriculum.innerHTML = '<p class="text-gray-600">Curriculum details not available.</p>';
                    }
                }

                // Event listener for the "Enroll in Course" button.
                if (enrollButton) { // Ensure element exists.
                    enrollButton.onclick = async () => { // Using onclick to easily replace the handler each time.
                        console.log("Enroll button clicked.");
                        if (!auth.currentUser || auth.currentUser.isAnonymous) {
                            showModalView('authForms');
                            authMessage.textContent = 'Please log in with an email account to enroll in courses.';
                            authMessage.classList.add('text-red-600');
                            return;
                        }
                        if (courseId) {
                            try {
                                const enrollmentRef = doc(db, `artifacts/${appId}/users/${auth.currentUser.uid}/enrollments`, courseId);

                                // Initialize progress for all modules to false upon enrollment.
                                const initialProgress = {};
                                if(course.modules) {
                                    course.modules.forEach(module => {
                                        initialProgress[module.id] = false;
                                    });
                                }

                                // Set enrollment document in Firestore.
                                await setDoc(enrollmentRef, {
                                    courseId: courseId,
                                    enrolledAt: new Date().toISOString(),
                                    status: 'enrolled',
                                    progress: initialProgress
                                });
                                courseStatusArea.innerHTML = `<p class="text-center text-green-600 font-semibold mb-2">Successfully enrolled in ${course.title}!</p>`;
                                // Re-populate the modal to reflect the new enrollment status (e.g., show progress bar, LLM buttons).
                                await populateCourseDetailModal(courseId);
                            } catch (error) {
                                console.error("Error enrolling in course:", error);
                                courseStatusArea.innerHTML = `<p class="text-center text-red-600 font-semibold mb-2">Failed to enroll in ${course.title}: ${error.message}</p>`;
                            }
                        }
                    };
                }

                // --- LLM (AI) Feature Button Listeners ---
                // Event listener for "Generate Study Plan" button.
                if (generateStudyPlanButton) {
                    generateStudyPlanButton.onclick = async () => {
                        console.log("Generate Study Plan button clicked.");
                        // Ensure user is logged in and enrolled before generating.
                        if (!auth.currentUser || !isEnrolled) {
                            showModalView('authForms');
                            authMessage.textContent = 'Please enroll in the course to use this feature.';
                            authMessage.classList.add('text-red-600');
                            return;
                        }
                        
                        studyPlanOutputDiv.classList.remove('hidden'); // Show output area.
                        studyPlanContentDiv.innerHTML = ''; // Clear previous content.
                        studyPlanLoadingDiv.classList.remove('hidden'); // Show loading indicator.

                        // Construct a detailed prompt for the LLM.
                        const prompt = `Generate a detailed study plan for the "${course.title}" course.
                        Course Description: ${course.description}
                        Key Learnings: ${course.learnings.join(', ')}
                        Curriculum Highlights: ${course.modules.map(m => m.title).join(', ')}
                        The plan should be structured week-by-week, covering the main topics and suggesting activities or projects. Aim for a duration of ${course.duration}.`;

                        try {
                            let chatHistory = [];
                            chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                            const payload = { contents: chatHistory };
                            const apiKey = ""; // Canvas environment provides this.
                            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                            const response = await fetch(apiUrl, {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify(payload)
                            });

                            const result = await response.json();

                            if (result.candidates && result.candidates.length > 0 &&
                                result.candidates[0].content && result.candidates[0].content.parts &&
                                result.candidates[0].content.parts.length > 0) {
                                const text = result.candidates[0].content.parts[0].text;
                                studyPlanContentDiv.innerHTML = formatMarkdownToHtml(text); // Format and display.
                            } else {
                                studyPlanContentDiv.textContent = 'Failed to generate study plan. Please try again.';
                                console.error('Gemini API response structure unexpected:', result);
                            }
                        } catch (error) {
                            studyPlanContentDiv.textContent = 'Error generating study plan. Please check your network connection or try again later.';
                            console.error('Error calling Gemini API:', error);
                        } finally {
                            studyPlanLoadingDiv.classList.add('hidden'); // Hide loading indicator.
                        }
                    };
                }

                // Event listener for "Generate Course FAQ" button.
                if (generateFaqButton) {
                    generateFaqButton.onclick = async () => {
                        console.log("Generate FAQ button clicked.");
                        // Ensure user is logged in and enrolled.
                        if (!auth.currentUser || !isEnrolled) {
                            showModalView('authForms');
                            authMessage.textContent = 'Please enroll in the course to use this feature.';
                            authMessage.classList.add('text-red-600');
                            return;
                        }
                        
                        faqOutputDiv.classList.remove('hidden'); // Show output area.
                        faqContentDiv.innerHTML = ''; // Clear previous content.
                        faqLoadingDiv.classList.remove('hidden'); // Show loading indicator.

                        // Construct prompt for FAQ generation.
                        const prompt = `Generate a list of 5-7 frequently asked questions (FAQs) and their answers for the "${course.title}" course.
                        Base the FAQs on the following information:
                        Course Description: ${course.description}
                        Key Learnings: ${course.learnings.join(', ')}
                        Curriculum Highlights: ${course.modules.map(m => m.title).join(', ')}
                        Format the output as a list of Q&A pairs.`;

                        try {
                            let chatHistory = [];
                            chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                            const payload = { contents: chatHistory };
                            const apiKey = "";
                            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                            const response = await fetch(apiUrl, {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify(payload)
                            });

                            const result = await response.json();

                            if (result.candidates && result.candidates.length > 0 &&
                                result.candidates[0].content && result.candidates[0].content.parts &&
                                result.candidates[0].content.parts.length > 0) {
                                const text = result.candidates[0].content.parts[0].text;
                                faqContentDiv.innerHTML = formatMarkdownToHtml(text); // Format and display.
                            } else {
                                faqContentDiv.textContent = 'Failed to generate FAQs. Please try again.';
                                console.error('Gemini API response structure unexpected:', result);
                            }
                        } catch (error) {
                            faqContentDiv.textContent = 'Error generating FAQs. Please check your network connection or try again later.';
                            console.error('Error calling Gemini API:', error);
                        } finally {
                            faqLoadingDiv.classList.add('hidden'); // Hide loading indicator.
                        }
                    };
                }

                // Event listener for "Generate Career Path Suggestions" button.
                if (generateCareerPathButton) {
                    generateCareerPathButton.onclick = async () => {
                        console.log("Generate Career Path button clicked.");
                        // Ensure user is logged in and enrolled.
                        if (!auth.currentUser || !isEnrolled) {
                            showModalView('authForms');
                            authMessage.textContent = 'Please enroll in the course to use this feature.';
                            authMessage.classList.add('text-red-600');
                            return;
                        }
                        
                        careerPathOutputDiv.classList.remove('hidden'); // Show output area.
                        careerPathContentDiv.innerHTML = ''; // Clear previous content.
                        careerPathLoadingDiv.classList.remove('hidden'); // Show loading indicator.

                        // Construct prompt for career path suggestions.
                        const prompt = `Generate career path suggestions for someone completing the "${course.title}" course.
                        Consider the following details:
                        Course Description: ${course.description}
                        Key Learnings: ${course.learnings.join(', ')}
                        Curriculum Highlights: ${course.modules.map(m => m.title).join(', ')}
                        Provide typical job roles, industries where these skills are in demand, and potential next steps or complementary skills to further career growth. Format the output as a list of suggestions.`;

                        try {
                            let chatHistory = [];
                            chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                            const payload = { contents: chatHistory };
                            const apiKey = "";
                            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                            const response = await fetch(apiUrl, {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify(payload)
                            });

                            const result = await response.json();

                            if (result.candidates && result.candidates.length > 0 &&
                                result.candidates[0].content && result.candidates[0].content.parts &&
                                result.candidates[0].content.parts.length > 0) {
                                const text = result.candidates[0].content.parts[0].text;
                                careerPathContentDiv.innerHTML = formatMarkdownToHtml(text); // Format and display.
                            } else {
                                careerPathContentDiv.textContent = 'Failed to generate career path suggestions. Please try again.';
                                console.error('Gemini API response structure unexpected:', result);
                            }
                        } catch (error) {
                            careerPathContentDiv.textContent = 'Error generating career path suggestions. Please check your network connection or try again later.';
                            console.error('Error calling Gemini API:', error);
                        } finally {
                            careerPathLoadingDiv.classList.add('hidden'); // Hide loading indicator.
                        }
                    };
                }
            }

            // --- Chatbot Logic ---
            const chatAiButton = document.getElementById('chat-ai-button');
            if (chatAiButton) { // Check if the "Chat with AI" button exists.
                chatAiButton.addEventListener('click', () => {
                    console.log("Chat with AI button clicked.");
                    // Prevent anonymous users from using the chatbot.
                    if (!auth.currentUser || auth.currentUser.isAnonymous) {
                        showModalView('authForms');
                        authMessage.textContent = 'Please log in to use the AI Chatbot.';
                        authMessage.classList.add('text-red-600');
                        return;
                    }
                    showModalView('chatbot'); // Show the chatbot modal.
                    
                    // Get chatbot specific elements.
                    const chatMessages = document.getElementById('chat-messages');
                    const chatInput = document.getElementById('chat-input');

                    // Reset chat messages and input when opening the chatbot.
                    if (chatMessages) {
                        chatMessages.innerHTML = '<div class="chat-message ai">Hello! How can I assist you with your learning journey today?</div>';
                        chatMessages.scrollTop = chatMessages.scrollHeight; // Scroll to bottom.
                    }
                    if (chatInput) {
                        chatInput.value = ''; // Clear input field.
                    }
                });
            }

            // Get chatbot input, send button, message area, and loading indicator.
            const chatInput = document.getElementById('chat-input');
            const chatSendButton = document.getElementById('chat-send-button');
            const chatMessages = document.getElementById('chat-messages');
            const chatLoading = document.getElementById('chat-loading');

            if (chatInput && chatSendButton && chatMessages && chatLoading) { // Ensure all chatbot elements exist.
                /**
                 * Sends a user message to the AI chatbot and displays the response.
                 */
                const sendMessage = async () => {
                    const userMessage = chatInput.value.trim(); // Get user input.
                    if (userMessage === '') return; // Do nothing if message is empty.

                    // Add user message to the chat display.
                    const userMessageDiv = document.createElement('div');
                    userMessageDiv.className = 'chat-message user';
                    userMessageDiv.textContent = userMessage;
                    chatMessages.appendChild(userMessageDiv);
                    chatMessages.scrollTop = chatMessages.scrollHeight; // Scroll to the latest message.

                    chatInput.value = ''; // Clear the input field.
                    chatSendButton.disabled = true; // Disable send button to prevent multiple submissions.
                    chatLoading.classList.remove('hidden'); // Show the AI typing indicator.

                    try {
                        let chatHistory = [];
                        // For a simple chatbot, we send only the current message.
                        // For a conversational chatbot, you would maintain and send the full chat history.
                        chatHistory.push({ role: "user", parts: [{ text: userMessage }] });
                        const payload = { contents: chatHistory };
                        const apiKey = ""; // Canvas environment provides this API key.
                        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        const result = await response.json();

                        let aiResponseText = 'Sorry, I could not get a response. Please try again.';
                        if (result.candidates && result.candidates.length > 0 &&
                            result.candidates[0].content && result.candidates[0].content.parts &&
                            result.candidates[0].content.parts.length > 0) {
                            aiResponseText = result.candidates[0].content.parts[0].text; // Extract AI's response.
                        } else {
                            console.error('Gemini API response structure unexpected:', result);
                        }

                        // Add AI's response to the chat display.
                        const aiMessageDiv = document.createElement('div');
                        aiMessageDiv.className = 'chat-message ai';
                        aiMessageDiv.innerHTML = formatMarkdownToHtml(aiResponseText); // Format AI response (e.g., markdown to HTML).
                        chatMessages.appendChild(aiMessageDiv);
                        chatMessages.scrollTop = chatMessages.scrollHeight; // Scroll to the latest message.

                    } catch (error) {
                        console.error('Error calling Gemini API for chatbot:', error);
                        const errorMessageDiv = document.createElement('div');
                        errorMessageDiv.className = 'chat-message ai text-red-600';
                        errorMessageDiv.textContent = 'Error: Could not connect to the AI. Please try again later.';
                        chatMessages.appendChild(errorMessageDiv);
                        chatMessages.scrollTop = chatMessages.scrollHeight;
                    } finally {
                        chatSendButton.disabled = false; // Re-enable the send button.
                        chatLoading.classList.add('hidden'); // Hide the AI typing indicator.
                    }
                };

                chatSendButton.addEventListener('click', sendMessage); // Send message on button click.
                chatInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && !chatSendButton.disabled) {
                        sendMessage(); // Send message on Enter key press.
                    }
                });
            } else {
                console.error("Chatbot elements not found. Chatbot functionality may be limited.");
            }

            // --- Payment Gateway Logic ---
            const paymentButton = document.getElementById('payment-button');
            if (paymentButton) {
                paymentButton.addEventListener('click', () => {
                    if (!auth.currentUser || auth.currentUser.isAnonymous) {
                        showModalView('authForms');
                        authMessage.textContent = 'Please log in to access payment features.';
                        authMessage.classList.add('text-red-600');
                        return;
                    }
                    showModalView('payment'); // Show the payment modal.

                    const cardNumberInput = document.getElementById('card-number');
                    const expiryDateInput = document.getElementById('expiry-date');
                    const cvcInput = document.getElementById('cvc');
                    const payNowButton = document.getElementById('pay-now-button');
                    const paymentMessage = document.getElementById('payment-message');
                    const paymentLoading = document.getElementById('payment-loading');
                    const paymentForm = document.getElementById('payment-form');

                    // Reset payment form state on open
                    cardNumberInput.value = '';
                    expiryDateInput.value = '';
                    cvcInput.value = '';
                    paymentMessage.textContent = '';
                    paymentLoading.classList.add('hidden');
                    payNowButton.disabled = false;

                    // Input formatting for card number
                    cardNumberInput.addEventListener('input', (e) => {
                        e.target.value = e.target.value.replace(/\D/g, '').replace(/(.{4})/g, '$1 ').trim();
                    });

                    // Input formatting for expiry date (MM/YY)
                    expiryDateInput.addEventListener('input', (e) => {
                        let value = e.target.value.replace(/\D/g, '');
                        if (value.length > 2) {
                            value = value.substring(0, 2) + '/' + value.substring(2, 4);
                        }
                        e.target.value = value;
                    });

                    paymentForm.onsubmit = async (e) => {
                        e.preventDefault();
                        paymentMessage.textContent = '';
                        paymentLoading.classList.remove('hidden');
                        payNowButton.disabled = true;

                        // Simulate payment processing
                        await new Promise(resolve => setTimeout(resolve, 2000)); // 2-second delay

                        const isSuccess = Math.random() > 0.3; // 70% chance of success

                        if (isSuccess) {
                            paymentMessage.textContent = 'Payment successful! Thank you for your purchase.';
                            paymentMessage.className = 'text-center mt-4 text-green-600';
                            // In a real app, you'd update user's enrollment or access here.
                            setTimeout(() => mainModal.classList.remove('show'), 2000); // Close after success message
                        } else {
                            paymentMessage.textContent = 'Payment failed. Please check your details and try again.';
                            paymentMessage.className = 'text-center mt-4 text-red-600';
                        }
                        paymentLoading.classList.add('hidden');
                        payNowButton.disabled = false;
                    };
                });
            }

            // --- Smooth scroll for anchor links ---
            // Applies smooth scrolling behavior when clicking on navigation links.
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault(); // Prevent default jump behavior.
                    const targetId = this.getAttribute('href'); // Get the target section's ID.
                    const targetElement = document.querySelector(targetId); // Find the target element.
                    if (targetElement) {
                        targetElement.scrollIntoView({
                            behavior: 'smooth' // Enable smooth scrolling.
                        });
                    }
                });
            });

            /**
             * Helper function to format markdown-like text to HTML.
             * This is a simplified markdown parser for common elements like headers, bold, italic, and lists.
             * @param {string} text - The input text containing markdown-like syntax.
             * @returns {string} - The text converted to HTML.
             */
            function formatMarkdownToHtml(text) {
                let formattedText = text;
                // Convert headers (###, ##, #) to H3, H2, H1 respectively.
                formattedText = formattedText.replace(/^### (.*$)/gim, '<h3>$1</h3>');
                formattedText = formattedText.replace(/^## (.*$)/gim, '<h2>$1</h2>');
                formattedText = formattedText.replace(/^# (.*$)/gim, '<h1>$1</h1>');
                // Convert bold (**) and italic (*) text.
                formattedText = formattedText.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                formattedText = formattedText.replace(/\*(.*?)\*/g, '<em>$1</em>');
                // Convert simple list items (- ) to <li> with a margin.
                formattedText = formattedText.replace(/^- (.*$)/gim, '<li class="ml-4">$1</li>');
                // Wrap list items in <ul> if they are present but not already wrapped.
                if (formattedText.includes('<li>') && !formattedText.includes('<ul>')) {
                    formattedText = '<ul>' + formattedText + '</ul>';
                }
                // Add paragraphs for lines that are not part of lists or headings.
                formattedText = formattedText.split('\n').map(line => {
                    const trimmedLine = line.trim();
                    // Check if the line already starts with a known HTML tag or is empty.
                    if (trimmedLine.startsWith('<h') || trimmedLine.startsWith('<ul') || trimmedLine.startsWith('<li') || trimmedLine.startsWith('<div') || trimmedLine === '') {
                        return line;
                    }
                    return `<p>${line}</p>`; // Wrap in paragraph tags.
                }).join('');

                // Clean up extra line breaks and empty paragraphs that might result from formatting.
                formattedText = formattedText.replace(/<br>\s*<br>/g, '<br>'); // Remove redundant <br> tags.
                formattedText = formattedText.replace(/<p><\/p>/g, ''); // Remove empty paragraphs.
                formattedText = formattedText.replace(/<\/li><p>/g, '</li>'); // Remove <p> immediately after </li>.
                formattedText = formattedText.replace(/<\/ul><p>/g, '</ul>'); // Remove <p> immediately after </ul>.
                formattedText = formattedText.replace(/<p>\s*<h/g, '<h'); // Remove <p> before headings.
                formattedText = formattedText.replace(/<p>\s*<ul/g, '<ul'); // Remove <p> before unordered lists.
                return formattedText;
            }
        }); // End of DOMContentLoaded event listener.
    </script>
</body>
</html>
